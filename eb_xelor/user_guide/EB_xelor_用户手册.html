<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.15">
<title>EB xelor 用户手册</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>EB xelor 用户手册</h1>
<div id="toc" class="toc2">
<div id="toctitle">目录</div>
<ul class="sectlevel1">
<li><a href="#_交付物">1. 交付物</a>
<ul class="sectlevel2">
<li><a href="#Obtain">1.1. 获取EB xelor</a></li>
<li><a href="#Configuration">1.2. 配置</a>
<ul class="sectlevel3">
<li><a href="#_conan_仓库">1.2.1. Conan 仓库</a></li>
<li><a href="#_git">1.2.2. Git</a></li>
</ul>
</li>
<li><a href="#Supplies">1.3. 来自供应商的文件</a>
<ul class="sectlevel3">
<li><a href="#_由nxp提供的文件">1.3.1. 由NXP提供的文件</a>
<ul class="sectlevel4">
<li><a href="#_llce">LLCE</a></li>
<li><a href="#_flasher">Flasher</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_开发工具">2. 开发工具</a>
<ul class="sectlevel2">
<li><a href="#Docker">2.1. Docker</a>
<ul class="sectlevel3">
<li><a href="#_概述">2.1.1. 概述</a></li>
<li><a href="#_安装并运行eb_xelor_docker容器">2.1.2. 安装并运行EB xelor docker容器</a></li>
<li><a href="#_目录结构">2.1.3. 目录结构</a></li>
<li><a href="#_troubleshooting">2.1.4. Troubleshooting</a></li>
</ul>
</li>
<li><a href="#Valeria">2.2. Valeria - 构建完整EB xelor软件包</a>
<ul class="sectlevel3">
<li><a href="#_基本理念">2.2.1. 基本理念</a></li>
<li><a href="#_build_manifest">2.2.2. Build manifest</a></li>
<li><a href="#_从其他channel拷贝包">2.2.3. 从其他channel拷贝包</a></li>
<li><a href="#_构建需求的处理">2.2.4. 构建需求的处理</a></li>
<li><a href="#_packages_that_deploy_files">2.2.5. Packages that deploy files</a></li>
<li><a href="#_如何调用valeria">2.2.6. 如何调用Valeria</a>
<ul class="sectlevel4">
<li><a href="#_lockfiles">Lockfiles</a></li>
<li><a href="#_linux">Linux</a></li>
<li><a href="#_windows">Windows</a></li>
<li><a href="#_下载发布包">下载发布包</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Development">2.3. 开发工作流</a>
<ul class="sectlevel3">
<li><a href="#_step_1_call_valeria">2.3.1. Step 1: call valeria</a></li>
<li><a href="#_step_2_使用conan工作流">2.3.2. Step 2: 使用Conan工作流</a></li>
</ul>
</li>
<li><a href="#Flashing">2.4. 烧写</a></li>
<li><a href="#_使用提供的库文件烧写">2.5. 使用提供的库文件烧写</a>
<ul class="sectlevel3">
<li><a href="#_rcar_h3的库文件">2.5.1. Rcar H3的库文件</a></li>
<li><a href="#_s32g的库文件">2.5.2. S32G的库文件</a></li>
<li><a href="#_配置文件">2.5.3. 配置文件</a></li>
<li><a href="#_命令行调用">2.5.4. 命令行调用</a></li>
<li><a href="#_使用python脚本调用">2.5.5. 使用python脚本调用</a></li>
</ul>
</li>
<li><a href="#ManualFlashingH3">2.6. Rcar H3 firmware 手动烧写</a></li>
<li><a href="#System_Analysis">2.7. 系统分析</a>
<ul class="sectlevel3">
<li><a href="#_dlt_viewer">2.7.1. DLT Viewer</a>
<ul class="sectlevel4">
<li><a href="#Install_DLT_Viewer_Linux">Installing DLT Viewer on Linux</a></li>
<li><a href="#_compiling_dlt_viewer_on_linux">Compiling DLT Viewer on Linux</a></li>
<li><a href="#Install_DLT_Viewer_Windows">Installing DLT Viewer on Windows</a></li>
<li><a href="#_compiling_dlt_viewer_on_windows">Compiling DLT Viewer on Windows</a></li>
<li><a href="#_sample_project_file">Sample project file</a></li>
<li><a href="#_dlt_identifiers_for_eb_xelor">DLT identifiers for EB xelor</a></li>
<li><a href="#_licensing">Licensing</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_eb_xelor详细介绍">3. EB xelor详细介绍</a>
<ul class="sectlevel2">
<li><a href="#Firmware">3.1. Firmware for R-Car H3</a>
<ul class="sectlevel3">
<li><a href="#_获取bin文件">3.1.1. 获取bin文件</a></li>
<li><a href="#_各个文件的描述">3.1.2. 各个文件的描述</a></li>
<li><a href="#_配置">3.1.3. 配置</a></li>
<li><a href="#_flashing_to_h3">3.1.4. Flashing to H3</a></li>
</ul>
</li>
<li><a href="#EBLinux">3.2. EB corbos Linux</a>
<ul class="sectlevel3">
<li><a href="#_获取镜像文件">3.2.1. 获取镜像文件</a></li>
<li><a href="#_各个文件的描述_2">3.2.2. 各个文件的描述</a></li>
<li><a href="#_配置_2">3.2.3. 配置</a></li>
<li><a href="#_yoctos_sstate_cache的使用">3.2.4. yocto&#8217;s sstate-cache的使用</a></li>
<li><a href="#_烧写到_h3">3.2.5. 烧写到 H3</a></li>
</ul>
</li>
<li><a href="#Hypervisor">3.3. EB corbos Hypervisor</a>
<ul class="sectlevel3">
<li><a href="#_获取镜像文件_2">3.3.1. 获取镜像文件</a></li>
<li><a href="#_各个文件的描述_3">3.3.2. 各个文件的描述</a></li>
<li><a href="#_配置_3">3.3.3. 配置</a>
<ul class="sectlevel4">
<li><a href="#_eb_corbos_linux_hostname">EB corbos Linux hostname</a></li>
<li><a href="#_hypervisors_vm1_bridges_ip">Hypervisor&#8217;s vm1 bridge&#8217;s IP</a></li>
<li><a href="#_vm_hub_hostname">vm-hub hostname</a></li>
<li><a href="#_使用方法">使用方法</a></li>
</ul>
</li>
<li><a href="#_烧写到_h3_2">3.3.4. 烧写到 H3</a></li>
</ul>
</li>
<li><a href="#EB_ADG">3.4. EB corbos AdaptiveCore</a>
<ul class="sectlevel3">
<li><a href="#_building_the_adg">3.4.1. Building the ADG</a></li>
<li><a href="#_description_of_binary_files">3.4.2. Description of binary files</a></li>
<li><a href="#_building_the_adg_2">3.4.3. Building the ADG</a></li>
<li><a href="#_adg_containers">3.4.4. ADG containers</a></li>
</ul>
</li>
<li><a href="#EBtresos">3.5. EB tresos以及示例程序RT_RefApp指南</a>
<ul class="sectlevel3">
<li><a href="#_概述_2">3.5.1. 概述</a></li>
<li><a href="#Install_Conan_Windows">3.5.2. 在Windows平台安装Conan</a></li>
<li><a href="#_install_jfrog_command_line_interface_in_windows">3.5.3. Install jfrog command line interface in Windows</a>
<ul class="sectlevel4">
<li><a href="#_build_the_eb_tresos_binaries">Build the EB tresos binaries</a></li>
</ul>
</li>
<li><a href="#_rt_refapp_installation_and_build">3.5.4. RT_RefApp installation and build</a>
<ul class="sectlevel4">
<li><a href="#_getting_the_rt_refapp_binaries">Getting the RT_RefApp binaries</a></li>
<li><a href="#_build_the_rt_refapp_binaries">Build the RT_RefApp binaries</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Diagnostic">3.6. Diagnostic</a>
<ul class="sectlevel3">
<li><a href="#_overview">3.6.1. Overview</a></li>
<li><a href="#_diagnostic_services">3.6.2. Diagnostic services</a>
<ul class="sectlevel4">
<li><a href="#_diagnosticsessioncontrol_0x10">DiagnosticSessionControl (0x10)</a></li>
<li><a href="#_ecureset_0x11">EcuReset (0x11)</a></li>
<li><a href="#_securityaccess_0x27">SecurityAccess (0x27)</a></li>
<li><a href="#_communicationcontrol_0x28">CommunicationControl (0x28)</a></li>
<li><a href="#_testerpresent_0x3e">TesterPresent (0x3E)</a></li>
<li><a href="#_controldtcsetting_0x85">ControlDTCSetting (0x85)</a></li>
<li><a href="#_responseonevent_0x86">ResponseOnEvent (0x86)</a></li>
<li><a href="#_readdatabyidentifier_0x22">ReadDataByIdentifier (0x22)</a></li>
<li><a href="#_writedatabyidentifier_0x2e">WriteDataByIdentifier (0x2E)</a></li>
<li><a href="#_cleardiagnosticinformation_0x14">ClearDiagnosticInformation (0x14)</a></li>
<li><a href="#_readdtcinformation_0x19">ReadDTCInformation (0x19)</a></li>
<li><a href="#_routinecontrol_0x31">RoutineControl (0x31)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#Network">4. 网络配置指南</a>
<ul class="sectlevel2">
<li><a href="#_eb_xelor_网络设置">4.1. EB xelor 网络设置</a></li>
<li><a href="#EB_corbos_vSwitch_overview">4.2. EB corbos vSwitch 介绍</a></li>
</ul>
</li>
<li><a href="#_词汇表">5. 词汇表</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_交付物">1. 交付物</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Obtain">1.1. 获取EB xelor</h3>
<div class="paragraph">
<p>你可以根据以下方式获取EB xelor</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Links to EB xelor deliveries and sources</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">角色</th>
<th class="tableblock halign-left valign-top">路径</th>
<th class="tableblock halign-left valign-top">内容</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">无法访问EB xelor github仓库的用户</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://artifactory-central.elektrobit.com:443/artifactory/eb_core_external-releases-generic/">Artifactory external releases</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Release documentation and copy of source code</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">能够访问EB xelor github仓库的用户</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://artifactory-central.elektrobit.com:443/artifactory/eb_core-releases-generic/">Artifactory internal releases</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Release documentation and script to clone the source code</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EB xelor 内部开发人员</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://gitext.elektrobitautomotive.com/EBcore/EBcore-main">EB GitHub</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">source code</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="Configuration">1.2. 配置</h3>
<div class="sect3">
<h4 id="_conan_仓库">1.2.1. Conan 仓库</h4>
<div class="paragraph">
<p>在`config/conan/config/remotes.txt`文件中，默认配置的是EB Artifactory仓库，根据实际需要进行更改。
如果你只想从EB下载二进制包，那么只需要保留这个路径：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>https://artifactory-central.elektrobit.com/api/conan/eb_core-releases-conan</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_git">1.2.2. Git</h4>
<div class="paragraph">
<p>如果你使用内部release的脚本获取源码，你可以选择你喜欢的方式进行获取，例如使用ssh key，而不是用户名/密码进行认证。</p>
</div>
<div class="paragraph">
<p>使用git时，请配置以下：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>git config --global color.ui auto
git config --global user.name "Firstname Lastname"
git config --global user.email "my.email@address.com"</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Supplies">1.3. 来自供应商的文件</h3>
<div class="paragraph">
<p>由于授权限制，个别文件需要你直接从供应商获取。</p>
</div>
<div class="sect3">
<h4 id="_由nxp提供的文件">1.3.1. 由NXP提供的文件</h4>
<div class="sect4">
<h5 id="_llce">LLCE</h5>
<div class="paragraph">
<p>低延时通信引擎（LLCE）固件包含以下4个二进制文件:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DTE.bin</p>
</li>
<li>
<p>PPE_RX.bin</p>
</li>
<li>
<p>PPE_TX.bin</p>
</li>
<li>
<p>FRPE.bin</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>你需要通过NXP获取他们，然后替换`test/software/config/flash_config_serials32g.json`中`filename`的路径。</p>
</div>
</div>
<div class="sect4">
<h5 id="_flasher">Flasher</h5>
<div class="paragraph">
<p>从NXP获取烧写工具`S32FlashTool`后，替换`test/software/config/flash_config_serials32g.json`中以下路径:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>flash_algorithms/QSPI</code></p>
</li>
<li>
<p><code>flash_algorithms/EMMC</code></p>
</li>
<li>
<p><code>flash_algorithms/SD</code></p>
</li>
<li>
<p><code>flash_writer</code></p>
</li>
<li>
<p><code>target_application</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_开发工具">2. 开发工具</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Docker">2.1. Docker</h3>
<div class="sect3">
<h4 id="_概述">2.1.1. 概述</h4>
<div class="paragraph">
<p>EB xelor提供docker容器以用来开发并构建EB xelor交付物，容器基于(Yocto Project/OECore tools) and Ubuntu 18.04，包含基本的开发工具，例如python3，git，git-lfs，repo tool，Conan。</p>
</div>
<div class="paragraph">
<p>容器文件dockerfile位于 <code>config/docker/Dockerfile</code> 。</p>
</div>
</div>
<div class="sect3">
<h4 id="_安装并运行eb_xelor_docker容器">2.1.2. 安装并运行EB xelor docker容器</h4>
<div class="paragraph">
<p>前提条件:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Linux机器或运行Linux的虚拟机。我们使用的是Ubuntu。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Step 1<br>
安装Docker CE:
<a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/" class="bare">https://docs.docker.com/install/linux/docker-ce/ubuntu/</a></p>
</div>
<div class="paragraph">
<p>创建组，并将你的用户名添加到组中:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>groupadd docker
sudo usermod -aG docker $USER</pre>
</div>
</div>
<div class="paragraph">
<p>注销登陆/重启后，运行 <code>docker run hello-world</code> 测试是否安装成功。</p>
</div>
<div class="paragraph">
<p>Step 2<br>
获取EB xelor代码, 请参阅 <a href="#Obtain">获取EB xelor</a>.</p>
</div>
<div class="paragraph">
<p>Step 3<br>
运行EB xelor docker容器</p>
</div>
<div class="paragraph">
<p>如果没有EB xelor docker镜像，可以通过运行这个脚本自动创建:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>tools/docker/run_docker.sh</pre>
</div>
</div>
<div class="paragraph">
<p>创建镜像后，`run_docker.sh`会检查各项配置并在命令行中报告发现的问题。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. `run_docker.sh`脚本的配置和信息</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">信息</th>
<th class="tableblock halign-left valign-top">说明</th>
<th class="tableblock halign-left valign-top">解决办法</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTION NEEDED: Git commit template is missing on host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EB xelor使用commit模板，脚本会检查git client是否配置并使用了这个模板</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果你需要向EB xelor提交源代码，你应当安装git commit模板，如果不需要，那么可以忽略这个信息</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SETUP: Set/update Conan authentication for remote(s) (Artifactory)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">脚本根据 <code>config/conan/config</code> 安装conan配置，并验证是否有权限访问Artifactory仓库</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供凭证信息。如果你使用不同的Artifactory仓库，你应该修改 <code>config/conan/config/remotes.txt</code> 文件</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SETUP: JFrog configuration needed, host is missing file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">我们使用JFrog命令行客户端从Artifactory仓库下载文件</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">根据提示输入凭证信息，只需要输入用户名和密码，其他提示问题可以使用默认值</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_目录结构">2.1.3. 目录结构</h4>
<div class="paragraph">
<p>在EB xelor docker容器中，`/workdir`映射到的是你运行`run_docker.sh`的路径.</p>
</div>
<div class="paragraph">
<p><code>run_docker.sh`会在这个文件夹下创建Conan缓存(</code>.conan`
directory)，即`/workdir/.conan`。因此，最好不要在源码路径运行这个脚本。</p>
</div>
<div class="paragraph">
<p>示例如下 (以克隆EBcore-main仓库为例):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mkdir ebxelor
cd ebxelor
git clone git@gitext.elektrobitautomotive.com:EBcore/EBcore-main.git
./EBcore-main/tools/docker/run_docker.sh</pre>
</div>
</div>
<div class="paragraph">
<p>Conan cache目录在`ebxelor/.conan`，对应的docker容器中路径是`/workdir/.conan`。</p>
</div>
</div>
<div class="sect3">
<h4 id="_troubleshooting">2.1.4. Troubleshooting</h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>源代码目录不应当属于root用户（组）。否则会有这样的提示信息:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Refusing to use a gid of 0</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>如果在VirtualBox中遇到了NAT的DNS问题:</p>
</div>
<div class="paragraph">
<p>Ubuntu 18.04 使用的是本地DNS缓存127.0.0.53，在容器中不会起效。因此Docker默认设置为 Google的8.8.8.8 DNS 服务器, 如果有防火墙设置可能会遇到问题。</p>
</div>
<div class="paragraph">
<p>Ubuntu 18.04中，<code>/etc/resolv.conf</code> 是一个符号链接 (<code>ls -l /etc/resolv.conf</code>)，指向
 <code>/run/systemd/resolve/stub-resolv.conf</code> (127.0.0.53)</p>
</div>
<div class="paragraph">
<p>更改路径到 <code>/run/systemd/resolve/resolv.conf</code>, 它列出了实际使用的DNS服务器：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo ln -sf /run/systemd/resolve/resolv.conf /etc/resolv.conf</pre>
</div>
</div>
<div class="paragraph">
<p>查看并验证是否修改成功: <code>cat /etc/resolv.conf</code></p>
</div>
<div class="paragraph">
<p>另外，你也可以修改VirtualBox DNS:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>VBoxManage modifyvm "VM name" --natdnshostresolver1 on</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Valeria">2.2. Valeria - 构建完整EB xelor软件包</h3>
<div class="paragraph">
<p>EB xelor附带名为"Valeria"的构建工具，支持为不同的SoC构建对应的EB xelor软件包。
Valeria封装了Conan命令的调用，通过单一指令方便用户构建xelor软件。
EB xelor包含拥有不同属性的Conan包集合，例如运行在A5x这样性能核上的EB corbos Linux，运行在R7这样实时核上的RT_RefApp，直接运行在CPU上的固件，运行在EB corbos Linux上的EB corbos AdaptiveCore。
Conan可以根据定义在profiles中的设置或选项，进行不同属性的处理。
EB xelor项目包含很多不同属性的包，如果想获取所有需要的包，每次都需要调用很多次Conan命令，Valeria则简化了这个过程，通过读取对应manifest中的构建信息，调用相应的Conan指令。</p>
</div>
<div class="sect3">
<h4 id="_基本理念">2.2.1. 基本理念</h4>
<div class="paragraph">
<p>Valeria首先调用 <code>conan export</code> 获得所有的EB xelor recipes，保证Conan知道如何构建所有包。然后调用 <code>conan install --build</code> 开始构建。最后，它会上传这些Conan包到远程仓库，例如Arifactory。</p>
</div>
<div class="paragraph">
<p>为了保证正确地构建对应平台的包，Valeria使用 <a href="https://docs.conan.io/en/latest/reference/profiles.html#build-profiles-and-host-profiles">conan build and host profiles</a>。</p>
</div>
<div class="paragraph">
<p>细节请参考后续章节。</p>
</div>
</div>
<div class="sect3">
<h4 id="_build_manifest">2.2.2. Build manifest</h4>
<div class="paragraph">
<p>Manifest文件描述了哪些包需要构建，如何构建这些包等信息。</p>
</div>
<div class="paragraph">
<p>对于R-Car H3，我们定义了两个manifest文件</p>
</div>
<div class="literalblock">
<div class="content">
<pre>config/valeria/r-car-h3/manifests/buildmanifest_linuxbuild.xml
config/valeria/r-car-h3/manifests/buildmanifest_windowsbuild.xml</pre>
</div>
</div>
<div class="paragraph">
<p>如果是S32G，则是</p>
</div>
<div class="literalblock">
<div class="content">
<pre>config/valeria/s32g/manifests/buildmanifest_linuxbuild.xml
config/valeria/s32g/manifests/buildmanifest_windowsbuild.xml</pre>
</div>
</div>
<div class="paragraph">
<p><code>buildmanifest_linuxbuild.xml</code> 代表Valeria会根据这个manifest文件在Linux环境中构建Conan包，与之对应的，<code>buildmanifest_windowsbuild.xml</code> 代表需要在Windows环境构建的manifest。</p>
</div>
<div class="paragraph">
<p>对于每一个包，都需要定义一套host和huild profiles。
例如，<code>config/valeria/s32g/manifests/buildmanifest_linuxbuild.xml</code> 中 <code>u-boot</code> 信息:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>        &lt;ComponentBuildSpec&gt;
            &lt;BuildProfile&gt;build/linux_x86_64&lt;/BuildProfile&gt;
            &lt;HostProfile&gt;host/A53&lt;/HostProfile&gt;
            &lt;HostProfile&gt;host/gcc7_arm64&lt;/HostProfile&gt;
            &lt;Recipe&gt;eb_u-boot&lt;/Recipe&gt;
        &lt;/ComponentBuildSpec&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><code>u-boot</code> 在Linux x86_64环境中构建，运行在S32G SoC的A53核上。
因此我们定义BuildProfile为 <code>build/linux_x86_64</code>，HostProfile则是 <code>host/A53</code>。
我们还会用到gcc-linaro编译器来构建 <code>u-boot</code>，所以我们还需要定义一个HostProfile为 <code>host/gcc7_arm64</code>。</p>
</div>
<div class="paragraph">
<p>Profiles位于 <code>config/valeria/r-car-h3/profiles</code>（R-Car H3） ，<code>config/valeria/s32g/profiles</code>（S32G）。</p>
</div>
<div class="paragraph">
<p>需要注意的是，并非所有recipes都会定义在这个manifest文件中，你只需要列出依赖链上起始recipe。
Conan会构建 <code>requires</code> 或 <code>build_requires</code> 列出的recipe。
例如:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>EB corbos Linux并没有列出来，因为它是Hypervisor的构建必须项，Linux镜像会是Hypervisor包的一部分</p>
</li>
<li>
<p>the compiler required for building the u-boot is not listed, as it is a build requirement of the u-boot.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>作为依赖项的Profile，Conan会自动读取它们。
例如构建firmware，需要用到gcc-linaro编译器，我们也会在manifest中指定firmware在linux环境中构建，Conan会知道需要先构建gcc-linaro。</p>
</div>
</div>
<div class="sect3">
<h4 id="_从其他channel拷贝包">2.2.3. 从其他channel拷贝包</h4>
<div class="paragraph">
<p>类似于在git的某个branch上工作，你可以创建你自己的Conan channel来添加新功能。
例如，EB xelor团队为每一个git分支都有对应名为merge-EBCORE-&lt;jira-id&gt;的channel。
为了重用主开发分支的包，当你使用 <code>--conan-copy-ref &lt;ref_user&gt;/&lt;ref_channel&gt;:&lt;ref_repo&gt;</code> 命令时，Valeria会拷贝这些包到你的临时channel。
在你构建之前，Valeria会在 <code>ref_user</code> 和 <code>ref_channel</code> 中搜索 <code>ref_repo</code> 包，如果找到了相同的RREV以及Package ID, Valeria 会下载到本地缓存，拷贝到你的user/channel中。
由于已经有了包，Conan不会再构建这些包。当你在自己的channel第一次构建，或者将master的改动merge到你的分支中时，这个选项对你会很有用。</p>
</div>
</div>
<div class="sect3">
<h4 id="_构建需求的处理">2.2.4. 构建需求的处理</h4>
<div class="paragraph">
<p>Conan假定 <a href="https://docs.conan.io/en/latest/devtools/build_requires.html">build requirement</a>的改动并不会影响使用它的人最终生成的包。
例如，当构建需求主要是CMake这样的构建工具时，就很有意义。
当然，像编译器这样的构建需求，肯定会有直接影响。
Conan文档推荐在相关recipe中定义并声明特定的设置或选项，使它在计算package ID时产生影响。
例如，编译器版本 <code>compiler.version</code> 会影响package ID的计算.
新的编译器会导致产生一个新的package ID，即使使用了 <code>missing</code> 选项，还是会触发rebuild。</p>
</div>
<div class="paragraph">
<p>Conan计算Package ID会包含需求版本和其他属性的影响，不需要额外设置。
更多信息请参考 <a href="https://docs.conan.io/en/latest/creating_packages/define_abi_compatibility.html">Conan package ABI compatibility</a>.</p>
</div>
<div class="paragraph">
<p>当然，对于持续集成系统来说，你的目标可能是希望开发人员的一个小改动能得到快速验证。
也就是说，你只想重新构建这个改动所影响的包。
因此，一般来说持续集成系统会用到 <code>missing</code> 选项。
另外，在合并验证时，你可能会用到channel拷贝功能，来完成branch rebase后的快速验证。</p>
</div>
<div class="paragraph">
<p>在EB xelor中，大多数包最后构建出来的二进制文件，都会由于构建需求的变动而不同。
例如, <code>RT_RefApp</code> demo是依赖于EB tresos AutoCore产品的，也就是说你可以通过Conan设定来解决构建需求的问题，但当你每次想rebuild的时候，你都需要手动更改设定。</p>
</div>
<div class="paragraph">
<p>为了解决这个问题，当使用 <code>--build &lt;policy&gt;</code> build policy时， Valeria通过以下方式处理构建需求:</p>
</div>
<div class="paragraph">
<p>将所有recipe导出到Conan缓存后， Valeria 会解析每一个依赖树。
它会检查每一个构建需求，是否在本地缓存或者远程仓库已经有了一个具有相同的名字，版本，user，channe，recipe版本和package ID的包。
如果Valeria找不到这样的包，它会重新构建这个包以及依赖于它的包。</p>
</div>
<div class="paragraph">
<p>如果你没有通过 <code>--build</code> 选项提供了构建policy，Conan会构建每一个包。</p>
</div>
</div>
<div class="sect3">
<h4 id="_packages_that_deploy_files">2.2.5. Packages that deploy files</h4>
<div class="paragraph">
<p>EB xelor中大多数提前构建好的Conan包，包含由Conan recipe <code>package()</code> 方法打包而成的构建物（firmware, 文件系统image等）。
当安装此类包时，它会根据Conan recipe <code>deploy()</code> 方法拷贝到用户空间中。
EB xelor uses Conan&#8217;s package deploy feature to get package contents available for the users and test systems.</p>
</div>
<div class="paragraph">
<p>执行Valeria构建命令时，它会构建并安装包，每一个安装的包都会部署在 <code>build/deploy/buildspec-x</code> 文件夹,  <code>x</code> 代表build manifest中构建内容的序号。</p>
</div>
<div class="paragraph">
<p>当再次执行Valeria构建命令(rebuilding)时，如果 <code>build/deploy</code> 文件夹不为空, Valeria 会停止构建并提示警告。
调用Valeria指令时指定 <code>-cdd</code> /  <code>--clean-deploy-dir</code> 选项, 它会在构建时自动清除 <code>build/deploy</code> 文件夹内容。</p>
</div>
</div>
<div class="sect3">
<h4 id="_如何调用valeria">2.2.6. 如何调用Valeria</h4>
<div class="paragraph">
<p>Valeria是一套python脚本，位于：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>tools/valeria/valeria.py</pre>
</div>
</div>
<div class="paragraph">
<p>不输入任何参数时，Valeria会显示帮助列表。</p>
</div>
<div class="paragraph">
<p>Valeria会在调用的目录下建立 <code>build</code> 子目录。
在这个目录下，Valeria安装Conan包，为每一个构建细则生成三个Conan lockfile。</p>
</div>
<div class="sect4">
<h5 id="_lockfiles">Lockfiles</h5>
<div class="paragraph">
<p>lockfiles命名规则如下:
<code>valeria-buildspec-&lt;number&gt;-&lt;step&gt;.lock</code>. <code>number</code> 代表build manifest中构建细则的位置。
lockfiles有如下这些 <code>step</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>valeria-buildspec-&lt;number&gt;-init.lock</code>:
在执行 <code>conan install</code> 之前，利用 <code>lock create</code> 命令生成。它包含构建细则中除了包版本信息的完整依赖树。
Valeria将这个文件作为执行 <code>conan install</code> 动作的输入信息。
这个文件包含构建需求信息。</p>
</li>
<li>
<p><code>valeria-buildspec-&lt;number&gt;-inst.lock</code>:
它是 <code>conan install</code> 命令的输出.
它包含构建的包的完整版本信息。
Additionally, each built Conan package has a 'modified' entry.</p>
</li>
<li>
<p><code>valeria-buildspec-&lt;number&gt;-full.lock</code>:
在执行 <code>conan install</code> 之后，利用 <code>lock create</code> 命令生成。
它包含构建或下载的包的完整版本信息。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_linux">Linux</h5>
<div class="paragraph">
<p>本节描述了如何为Renesas R-Car H3和NXP S32G构建完整EB xelor包。
以NXP S32G为例，如果你想构建H3, 只需要将 <code>s32g</code> 替换为 <code>r-car-h3</code>。</p>
</div>
<div class="paragraph">
<p>假设源代码在：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>/workdir/EBxelor-2020.12</pre>
</div>
</div>
<div class="paragraph">
<p>构建的输出文件在：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>/workdir/valeria/s32g</pre>
</div>
</div>
<div class="paragraph">
<p>执行以下命令：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mkdir -p /workdir/valeria/s32g
cd /workdir/valeria/s32g
/workdir/EBxelor-2020.12/tools/valeria/valeria.py -b missing -M build \
-m /workdir/EBxelor-2020.12/config/valeria/s32g/manifests/\
buildmanifest_linuxbuild.xml \
-p /workdir/EBxelor-2020.12/config/valeria/s32g/profiles \
-r /workdir/EBxelor-2020.12/pkg \
-cr eb_core-devdrops \
-ccr EBxelor/2020.12:eb_core-releases \
-cdd \
your_user valeria-test</pre>
</div>
</div>
<div class="paragraph">
<p>以上命令中出现的选项：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-b missing -M build</code>: 构建本地Conan缓存没有的包，使用的构建参数是 <code>missing</code></p>
</li>
<li>
<p><code>-m /workdir/EBxelor-2020.12/config/valeria/s32g/manifests/buildmanifest_linuxbuild.xml</code>: 使用的build manifest</p>
</li>
<li>
<p><code>-p /workdir/EBxelor-2020.12/config/valeria/s32g/profiles</code>: profile路径</p>
</li>
<li>
<p><code>-r /workdir/EBxelor-2020.12/pkg</code>: recipe路径，子目录也会被解析</p>
</li>
<li>
<p><code>-cr eb_core-devdrops</code>:  <code>conan remote</code> 会使用到的Artifactory仓库。EB xelor的开发使用 <code>eb_core-devdrops</code> 仓库</p>
</li>
<li>
<p><code>-ccr EBxelor/2020.12:eb_core-releases</code>: 从用户 <code>EBxelor</code> ，channel <code>2020.12</code> ，仓库 <code>eb_core-releases</code> 拷贝已有（相同）的包</p>
</li>
<li>
<p><code>-cdd</code>: 删除已有的构建目录</p>
</li>
<li>
<p><code>your_user valeria-test</code>: Conan 用户 和 channel</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>后续的调用中， <code>-ccr</code> 选项可以忽略，它是第一次创建新channel  <code>user/valeria-test</code> 时用到的。</p>
</div>
<div class="paragraph">
<p>如果你想上传包到远程仓库，使用 <code>-n 0</code> 命令。</p>
</div>
</div>
<div class="sect4">
<h5 id="_windows">Windows</h5>
<div class="paragraph">
<p>假定源代码位于 <code>./EBxelor-2020.12</code> ，我们在同目录创建一个工作目录 <code>./EBxelor-2020.12</code> 。</p>
</div>
<div class="paragraph">
<p>同时，我们也假定构建命令在例如git bash或cygwin这样的bash shell中执行。</p>
</div>
<div class="paragraph">
<p>在Windows环境下的详细构建指导，请参考 <a href="#EBtresos">EB tresos以及示例程序RT_RefApp指南</a> 。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd valeria-build
python ../EBxelor-2020.12/tools/valeria/valeria.py -b missing -M build \
-m ../EBxelor-2020.12/config/valeria/s32g/manifests/\
buildmanifest_windowsbuild.xml \
-p ../EBxelor-2020.12/config/valeria/s32g/profiles \
-r ../EBxelor-2020.12/pkg \
-cr eb_core-devdrops \
-ccr EBxelor/2020.12:eb_core-releases \
-cdd \
your_user valeria-test</pre>
</div>
</div>
<div class="paragraph">
<p>参数定义和上方Linux环境构建时相同。</p>
</div>
</div>
<div class="sect4">
<h5 id="_下载发布包">下载发布包</h5>
<div class="paragraph">
<p>你也可以调用Valeria直接下载EB xelor发布包。
以S32G的 <code>2020.12</code> Linux环境发布包为例:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mkdir -p /workdir/valeria/s32g
cd /workdir/valeria/s32g
/workdir/EBxelor-2020.12/tools/valeria/valeria.py -b missing -M build \
-m /workdir/EBxelor-2020.12/config/valeria/s32g/manifests/\
buildmanifest_linuxbuild.xml \
-p /workdir/EBxelor-2020.12/config/valeria/s32g/profiles \
-r /workdir/EBxelor-2020.12/pkg \
-cr eb_core-releases \
-cdd \
EBxelor 2020.12</pre>
</div>
</div>
<div class="paragraph">
<p>这个时候我们不使用 <code>-ccr</code> ，conan包不会被拷贝到另一个user/channel当中。
你需要使用用户 <code>EBxelor</code> ，channel <code>2020.12</code>, 仓库 <code>eb_core-releases</code> 。
当然，你也无法将包上传到 <code>eb_core-releases</code> 中。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>如果本地源代码(目录 <code>/workdir/EBxelor-2020.12</code>) 与发布（例如 <code>EBxelor 2020.12</code> ）完全相同, 那么这些包将直接从Artifactory下载，而不会rebuild。</p>
</div>
<div class="paragraph">
<p>如果本地recipe有改动，那么这个recipe会被重新构建。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>以S32G的 <code>2020.12</code> Windows环境发布包为例:
(更多Windows环境下Conan配置信息，请参考 <a href="#EBtresos">EB tresos以及示例程序RT_RefApp指南</a> ):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd valeria-build
python ../EBxelor-2020.12/tools/valeria/valeria.py -b missing -M build \
-m ../EBxelor-2020.12/config/valeria/s32g/manifests/\
buildmanifest_windowsbuild.xml \
-p ../EBxelor-2020.12/config/valeria/s32g/profiles \
-r ../EBxelor-2020.12/pkg \
-cr eb_core-releases \
-cdd \
EBxelor 2020.12</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>如果不想触发重新构建，你可以运行Valeria命令直接下载二进制文件，对于Windows，Manifest文件是 <code>buildmanifest_windowsbuild.xml</code> 对于Linux，则是 <code>buildmanifest_linuxbuild.xml</code> 。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Development">2.3. 开发工作流</h3>
<div class="paragraph">
<p>本节将介绍如何利用EB xelor开发包。</p>
</div>
<div class="sect3">
<h4 id="_step_1_call_valeria">2.3.1. Step 1: call valeria</h4>
<div class="paragraph">
<p>首先你需要将所有包的信息取到本地conan缓存，保证所有需要的依赖都在你的本地。
如果你设置好了conan remote仓库，用户，和channel，所有未修改的包都会从Artifactory获得，而不需要重新构建。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>使用stable channel时，注意不要随意上传文件。
开发时，建议使用你自己的用户和channel。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>EB xelor团队使用特定的仓库用来开发。
EB xelor持续集成系统使用 <code>EBcore/merge-EBCORE-1234</code> 来做合并验证,  <code>EBCORE-1234</code> 是git仓库的一个分支名。
本地使用同样的配置时，本地开发和持续集成系统会关联起来，方便重用包而不用重新构建。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>为了减少Valeria运行时间，你可以：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果开发只涉及部分EB xelor代码，创建一个精简版Valeria build manifest</p>
</li>
<li>
<p>利用 <code>--build-policy</code> 指定你开发的包，pattern可参考</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_step_2_使用conan工作流">2.3.2. Step 2: 使用Conan工作流</h4>
<div class="paragraph">
<p>运行完Valeria命令后，使用 <a href="https://docs.conan.io/en/latest/developing_packages/package_dev_flow.html">conan package 开发工作流</a>.</p>
</div>
<div class="paragraph">
<p>作为例子，我们为R-Car H3改动位于 <code>pkg/eb_u-boot/conan</code> 的 <code>u-boot</code> 包。</p>
</div>
<div class="paragraph">
<p>调用conan指令时，你需要指定相应的profile配置。
你可以通过build manifest或者valeria输出来决定这些设置：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[valeria] invoke: conan lock create
--reference eb_u-boot/0.1.0@your_user/valeria-test
--lockfile valeria-buildspec-1-init.lock
--lockfile-out valeria-buildspec-1-full.lock
--profile:host
/workdir/EBcore-main/config/valeria/r-car-h3/profiles/host/A5x
--profile:host
/workdir/EBcore-main/config/valeria/r-car-h3/profiles/host/
gcc7_arm64
--profile:build
/workdir/EBcore-main/config/valeria/r-car-h3/profiles/build/linux_x86_64</pre>
</div>
</div>
<div class="paragraph">
<p>进入 <code>pkg/eb_u-boot/conan</code> 目录，然后执行：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>conan install \
--profile:host \
/workdir/EBcore-main/config/valeria/r-car-h3/profiles/host/A5x \
--profile:host \
/workdir/EBcore-main/config/valeria/r-car-h3/profiles/host/\
gcc7_arm64 \
--profile:build \
/workdir/EBcore-main/config/valeria/r-car-h3/profiles/build/linux_x86_64 \
--install-folder build . your-user/valeria-test</pre>
</div>
</div>
<div class="paragraph">
<p>执行之后，所有构建相关的设定会在build文件夹中，然后你可以执行</p>
</div>
<div class="literalblock">
<div class="content">
<pre>conan source --source-folder build --install-folder build .
conan build --build-folder build .</pre>
</div>
</div>
<div class="paragraph">
<p>来构建u-boot包。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>后续开发中，建议先用构建系统构建一次集成好的包，然后做增量（开发）构建。例如：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd build/u-boot-2018.09-rcar-3.9.5
export ARCH=arm64
export CROSS_COMPILE=\
/workdir/.conan/data/gcc7-arm64/0.1.0/your-user/\
valeria-test/package/\
4db1be536558d833e52e862fd84d64d75c2b3656/\
gcc-linaro-7.3.1-2018.05-x86_64_aarch64-linux-gnu/bin/\
aarch64-linux-gnu-
make -j 4</pre>
</div>
</div>
<div class="paragraph">
<p>开发完成后，再次调用conan。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>基于EB xelor模板创建一个新的recipe文件 (conanfile.py):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>conan new --template pkg mypackage/1.2.3</pre>
</div>
</div>
<div class="paragraph">
<p>然后遵从step 2中的conan包开发工作流来开发你自己的包。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Flashing">2.4. 烧写</h3>
<div class="paragraph">
<p>EB xelor以Conan包形式提供二进制文件。
你可以手动或者通过调用python库的方式进行烧写。</p>
</div>
<div class="paragraph">
<p>当前只在原生Linux环境进行过验证，Cygwin或者虚拟机环境，或者是容器中，理论上也可行。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>所需的Python库列在
'/tools/lib/python/ebcoreflashlib/' 目录下的requirements.txt文件中.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo pip3 install -r requirements.txt</pre>
</div>
</div>
<div class="paragraph">
<p>Linux环境下，以下包也是必须的：
fastboot, ethtool, expect</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo apt install -y fastboot ethtool expect</pre>
</div>
</div>
<div class="paragraph">
<p>当前只在Linux环境进行过验证，如果你在Windoes环境设置了fastboot的PATH环境变量，理论上也是可行的。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_使用提供的库文件烧写">2.5. 使用提供的库文件烧写</h3>
<div class="sect3">
<h4 id="_rcar_h3的库文件">2.5.1. Rcar H3的库文件</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Notes before flashing H3 firmware</div>
<div class="paragraph">
<p>检查H3
目标板上有正确的CPLD (Complex Programmable Logic Device, used for configuring the SoC&#8217;s mode pins) 软件版本(20161005)。</p>
</div>
<div class="paragraph">
<p>如果软件版本低于20161005，请先升级。
如果软件版本高于20161005, 考虑到可能会有时钟问题，不推荐降级处理 (有可能导致目标板无法启动)。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>作为前提条件的是，你需要提前准备好Renesas H3的flash writer并且flasher可以调用到，你可以通过以下方式手动下载flash writer进行验证。</p>
</div>
<div class="paragraph">
<p>flash writer源代码可以从 <a href="https://github.com/renesas-rcar/flash_writer" class="bare">https://github.com/renesas-rcar/flash_writer</a> 获取。</p>
</div>
<div class="paragraph">
<p>如果由于路径问题无法设置在manifest中，你可以命令行调用的时候给入参数。</p>
</div>
<div class="paragraph">
<p>The flash library provides an interface for erasing and writing images to QSPI and eMMC flash memory in an automated way,
thus supporting usage on personal computers as well as in an automated toolchain (e.g. a Jenkins setup).
It can be configured via a JSON file and command line options.</p>
</div>
<div class="paragraph">
<p>Data transmission is possible over serial interface for QSPI, over fastboot/UDP for eMMC as soon as u-boot is installed, and over SSH as soon as Linux is booted.
The serial connection is also required for initializing fastboot transmission.
The flashing library uses the pexpect Python module to analyse the output patterns of the software running on the target.
The output is sent over the serial interface.
The flashing library implements the flow control to stop the target in the u-boot if required.</p>
</div>
<div class="paragraph">
<p>It is possible to flash only single memory areas or groups of multiple areas.</p>
</div>
<div class="paragraph">
<p>The config file can be validated against a JSON schema.</p>
</div>
<div class="paragraph">
<p>During the write process it can be necessary to operate some of the board&#8217;s dip switches.
The library can trigger this automatically when given a set of callback functions doing the
actual switching (use --hw parameter). If you do not work in an automated test environment, you need
to apply the switches as described in Step 1 of <a href="#ManualFlashingH3">Rcar H3 firmware 手动烧写</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Remove the board&#8217;s main power before changing the mode switches. The mode switches are read by
the CPLD when the board first gets power, not when turning it on by pressing the power button.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The library is implemented in Python and can be called directly from another Python program or from the command line.</p>
</div>
<div class="paragraph">
<p><strong>Prerequisites</strong> for executing the flasher script:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Serial connection to the board</p>
</li>
<li>
<p>Ethernet (for fastboot eMMC flashing and SSH file transfer)</p>
</li>
<li>
<p>Image files available (QSPI images have to be in .srec format)</p>
</li>
<li>
<p>Renesas Flash Writer for serial flashing</p>
</li>
<li>
<p>Python 3 installed (at least version 3.8)</p>
</li>
<li>
<p>Configuration file according to schema defined in <code>EBcore-main/tools/lib/python/ebcoreflashlib/JSON_flashlayout_schema.json</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_s32g的库文件">2.5.2. S32G的库文件</h4>
<div class="paragraph">
<p>作为前提条件，你需要从NXP获取S32G flashing tool，然后安装。</p>
</div>
<div class="paragraph">
<p>flashing tool路径需要在manifest文件中设置。</p>
</div>
<div class="paragraph">
<p>为了让flasher工作，你还需要设置S32G板子上的跳线，使之工作在Serial Boot模式。
如果想用eMMC，你需要调整J50跳线。The silk screen near the jumper describes how to set it.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 70%;">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Mode</th>
<th class="tableblock halign-left valign-top">SW14</th>
<th class="tableblock halign-left valign-top">SW15</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serial Boot Mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On-Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off-Off</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normal Boot Mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off-Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off-Off</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Flash库提供QSPI, eMMC, SD卡以及Linux文件系统的擦写接口，既可以单用户使用或者给自动化工具使用
(e.g. a Jenkins setup).
配置项可以通过JSON文件或命令行选项进行设置。</p>
</div>
<div class="paragraph">
<p>NXP flash tool通过串口进行通信，u-boot安装后可以通过fastboot/UDP通信，Linux安装后可以通过SSH方式进行通信。
Fastboot传输需要串口链接做初始化。</p>
</div>
<div class="paragraph">
<p>你可以一次只烧写一块内存或者一组内存区域。</p>
</div>
<div class="paragraph">
<p>库文件提供回掉函数，以方便在写入过程中需要调整dip开关。</p>
</div>
<div class="paragraph">
<p>库文件由Python语言编写，你可以通过命令行或在其他Python脚本中调用。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>脚本已在Linux环境测试。
如果在PATH中设置了fastboot工具，Windows环境也能工作。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>执行flasher脚本的 <strong>前提条件</strong> :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>与板子之间的串口连接</p>
</li>
<li>
<p>以太网连接 (for fastboot eMMC flashing and SSH file transfer)</p>
</li>
<li>
<p>镜像文件 (QSPI images have to be in .s32 format)</p>
</li>
<li>
<p>给串口使用的：NXP flash tool, target application ，flash algorithm file</p>
</li>
<li>
<p>已安装Python 3 (at least version 3.8)</p>
</li>
<li>
<p>遵从 <code>EBcore-main/tools/lib/python/ebcoreflashlib/JSON_flashlayout_schema.json</code> schema的配置文件</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_配置文件">2.5.3. 配置文件</h4>
<div class="paragraph">
<p>包含烧写区块，分组，网络，内存地址等信息。
配置文件配置项如下:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">flash_area</dt>
<dd>
<p>烧写内容:</p>
<div class="ulist">
<ul>
<li>
<p>filename: 文件名</p>
</li>
<li>
<p>files: 如果使用 <code>file_installation</code> 选项, 则代表文件列表</p>
</li>
<li>
<p>flash_address: 起始地址 (以0x开头的十六进制数, 至少两位)</p>
</li>
<li>
<p>mem_size: 大小 (以0x开头的十六进制数, 至少两位) - only necessary for S32G targets</p>
</li>
<li>
<p>block_size: block大小，Necessary for erasing (and consequently for writing) memory areas (hex with 0x prefix, at least two digits) - 仅针对S32G</p>
</li>
<li>
<p>memory_type: <code>QSPI</code>, <code>eMMC</code>, <code>SD</code>, 或者 <code>file</code></p>
</li>
<li>
<p>RAM_address: RAM 映射地址 - 仅针对H3</p>
</li>
<li>
<p>supported_protocol: <code>serial</code>, <code>fastboot</code>, 或 <code>file_installation</code></p>
</li>
<li>
<p>install_script:  如果使用 <code>file_installation</code> 选项, 文件传输结束后执行的脚本</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">flash_writer</dt>
<dd>
<p>Renesas flash writer 或 NXP flash tool 文件路径， 路径是 <code>path_to_firmware</code> 的相对路径</p>
</dd>
<dt class="hdlist1">flash_algorithms</dt>
<dd>
<p>以JSON键值对形式表示, 代表烧写区域/烧写算法，其路径为 <code>path_to_firmware</code> 的相对路径- 仅针对S32G</p>
</dd>
<dt class="hdlist1">target_application</dt>
<dd>
<p>目标程序二进制文件。 其路径为 <code>path_to_firmware</code> 的相对路径- 仅针对S32G</p>
</dd>
<dt class="hdlist1">group</dt>
<dd>
<p>JSON objects for groups, each consisting of a single list of area names. Necessary if multiple flash areas of the same type shall be flashed with one command.</p>
</dd>
<dt class="hdlist1">partition_table</dt>
<dd>
<p>eMMC partitions, each with a name and a size. Optionally the first partition can have a start address. Only necessary for the <code>fastboot</code> flash method.</p>
</dd>
<dt class="hdlist1">path_to_firmware</dt>
<dd>
<p>镜像文件和flash writer的base路径</p>
</dd>
<dt class="hdlist1">target_ip_address</dt>
<dd>
<p>fastboot UDP传输时使用的IP地址 - <code>fastboot</code> 时有用</p>
</dd>
<dt class="hdlist1">target_mac_address</dt>
<dd>
<p>目标MAC地址 - <code>fastboot</code> only</p>
</dd>
<dt class="hdlist1">target_username</dt>
<dd>
<p>SSH 登陆时用户名 - <code>file_installation</code> only</p>
</dd>
<dt class="hdlist1">target_password</dt>
<dd>
<p>SSH 登陆时密码 - <code>file_installation</code> only</p>
</dd>
<dt class="hdlist1">target_tmp_folder</dt>
<dd>
<p>A temporary folder on the target to store files - <code>file_installation</code> only</p>
</dd>
<dt class="hdlist1">use_external_emmc</dt>
<dd>
<p>Whether to use external eMMC - not tested yet</p>
</dd>
<dt class="hdlist1">version</dt>
<dd>
<p>Config file version - not necessary for flashing, but</p>
</dd>
<dt class="hdlist1">MX25UM51245G_MEM_START</dt>
<dd>
<p>QSPI memory起始地址 - S32G only</p>
</dd>
<dt class="hdlist1">MX25UM51245G_MEM_BLOCK_SIZE</dt>
<dd>
<p>Memory块大小 - S32G only</p>
</dd>
<dt class="hdlist1">MX25UM51245G_MEM_SIZE</dt>
<dd>
<p>QSPI memory大小 - S32G only</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If a parameter is missing or specified incorrectly, it will very probably lead to an error in the flashing execution.</p>
</div>
<div class="paragraph">
<p>示例可参考：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>EBcore-main/test/software/config/
EBcore-main/tools/lib/python/ebcoreflashlib/examples/</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>如果你在配置文件中使用绝对路径，请将 <code>path_to_firmware</code>
留空！</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_命令行调用">2.5.4. 命令行调用</h4>
<div class="paragraph">
<p><strong>使用方法:</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>python3 EBcore-main/tools/flasher/ebCoreFlasher.py \
--manifest_file path_to_config_file.json \
--flash_method method \
[optional parameters]</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Parameters:</strong></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">--manifest_file</dt>
<dd>
<p>Path to the config file.</p>
</dd>
<dt class="hdlist1">--flash_method</dt>
<dd>
<p>Flash method to be used for the area given: <code>fastboot</code>, <code>serial</code> or <code>file_installation</code></p>
</dd>
<dt class="hdlist1">-v, --verbose</dt>
<dd>
<p>Set logging level to DEBUG.</p>
</dd>
<dt class="hdlist1">--target_type</dt>
<dd>
<p>Name of the target board SoC: <code>r-car-h3</code> or <code>s32g</code></p>
</dd>
<dt class="hdlist1">--flash_area</dt>
<dd>
<p>Name of flash area / group to flash.</p>
</dd>
<dt class="hdlist1">--erase_emmc</dt>
<dd>
<p>Erase eMMC using the flash_method given. Currently only serial interface is supported.</p>
</dd>
<dt class="hdlist1">--erase_qspi</dt>
<dd>
<p>Erase QSPI using the flash_method given. Currently only serial interface is supported.</p>
</dd>
<dt class="hdlist1">--erase_sd</dt>
<dd>
<p>Erase SD using the flash_method given. Currently only serial interface is supported.</p>
</dd>
<dt class="hdlist1">--flash_writer</dt>
<dd>
<p>Name of the flash writer file.</p>
</dd>
<dt class="hdlist1">--target_ip_address</dt>
<dd>
<p>IP address of the target system.</p>
</dd>
<dt class="hdlist1">--target_mac_address</dt>
<dd>
<p>MAC address of the target system.</p>
</dd>
<dt class="hdlist1">--com_port</dt>
<dd>
<p>Serial port to be used for the communication (default=<code>/dev/ttyUSB0</code>).</p>
</dd>
<dt class="hdlist1">--baudrate</dt>
<dd>
<p>Serial port baudrate (default=<code>115200</code>).</p>
</dd>
<dt class="hdlist1">--path_to_firmware</dt>
<dd>
<p>Path to the firmware files.</p>
</dd>
<dt class="hdlist1">--reboot_target</dt>
<dd>
<p>Reboot target after flashing.</p>
</dd>
<dt class="hdlist1">--json_schema_file</dt>
<dd>
<p>JSON schema for validating the manifest file.</p>
</dd>
<dt class="hdlist1">--json_schema_check_dry</dt>
<dd>
<p>Don't write any memory, only validate the manifest file.</p>
</dd>
<dt class="hdlist1">--manual_callback_timeout</dt>
<dd>
<p>Set timeout when operating the target power and dip switches manually.</p>
</dd>
<dt class="hdlist1">--hw</dt>
<dd>
<p>Hardware description file which can be used to automate the user callbacks.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Command line parameters override those in the config file.</p>
</div>
<div class="paragraph">
<p><strong>Example calls</strong><br>
(assuming your working directory is <code>EBcore-main/tools/flasher</code> and the binaries are stored in
<code>../../../../artifacts</code> (or similar)):</p>
</div>
<div class="paragraph">
<p>Writing QSPI firmware to H3 board:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>python3 ./ebCoreFlasher.py \
--manifest_file ../../test/software/config/Fw_RcarH3_8GB.json \
--flash_method serial \
--flash_area QSPI_firmware \
--path_to_firmware=../../../../artifacts \
--target_type r-car-h3 \
--hw /platform.json</pre>
</div>
</div>
<div class="paragraph">
<p>Writing all eMMC partitions of an H3 board:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>python3 ./ebCoreFlasher.py \
--manifest_file ../../test/software/config/Fw_RcarH3_4GB.json \
--flash_method fastboot \
--target_type r-car-h3 \
--flash_area EMMC</pre>
</div>
</div>
<div class="paragraph">
<p>Erasing all H3 memory:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>python3 ebCoreFlasher.py \
--manifest_file ../../test/software/config/Fw_RcarH3_4GB.json \
--flash_method serial \
--target_type r-car-h3 \
--erase_emmc \
--erase_qspi</pre>
</div>
</div>
<div class="paragraph">
<p>Install the adaptivecore-container. Assumption: the artifacts are located in directory <code>../artifacts</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>python3 ./tools/flasher/ebCoreFlasher.py \
--manifest_file ./test/software/config/vm-alpha.json \
--flash_method file_installation \
--flash_area adaptivecore-container \
--target_type r-car-h3 \
--path_to_firmware=../../artifacts \</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_使用python脚本调用">2.5.5. 使用python脚本调用</h4>
<div class="paragraph">
<p>Main file of the library is</p>
</div>
<div class="literalblock">
<div class="content">
<pre>EBcore-main/tools/lib/python/ebcoreflashlib/flasher.py</pre>
</div>
</div>
<div class="paragraph">
<p>It can be used in other Python scripts like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>import ebcoreflashlib
my_flasher = ebcoreflashlib.Flasher(manifest_file, com_port)</pre>
</div>
</div>
<div class="paragraph">
<p>Parameters are similar to those mentioned above.
<code>manifest_file</code> and <code>com_port</code> are mandatory.
Refer also to the docstring for detailed descriptions.</p>
</div>
<div class="paragraph">
<p>The flashing library provides the functionality to flash defined memory areas on the QSPI.
There is no file system on the QSPI.
The memory areas are directly addressed by a start address and a length.
For eMMC flashing you can define an image which is flashed to a defined partition on the eMMC.</p>
</div>
<div class="paragraph">
<p>For modifying single files in the file system, you can use the expectSSH.py file.
It provides the functionality to execute a command on the target.</p>
</div>
<div class="paragraph">
<p>Connect to the target using the expect library:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>target = ExpectSSHConsole()
target.connect_and_login_to_vm(configuration)</pre>
</div>
</div>
<div class="paragraph">
<p>Execute</p>
</div>
<div class="literalblock">
<div class="content">
<pre>target.run("scp -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no "\
           f"-p {tmp_file.name} {self.user}@{self.ip}:{test_file}")</pre>
</div>
</div>
<div class="paragraph">
<p>This example copies a file from a remote host to the target.
The UserKnownHostsFile is redirected to the /dev/null device.
This prevents the key from being stored.
The option "StrictHostKeyChecking=no" is used to ignore key errors.
If you do not use this option you must have the correct host keys installed on the target.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ManualFlashingH3">2.6. Rcar H3 firmware 手动烧写</h3>
<div class="paragraph">
<p><strong>Prerequisites:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Firmware binary files are available</p>
</li>
<li>
<p>Flash Writer from Renesas available</p>
</li>
<li>
<p>Linux host with Minicom terminal emulator (<code>sudo minicom -D ttyx</code>)</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Hardware and Software Flow Control must be turned off in Minicom serial port setup.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Remove the board&#8217;s main power before changing the mode switches. The mode switches are read by
the CPLD when the board first gets power, not when turning it on by pressing the power button.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Step 1<br>
Start Minicom. Prepare Board and flash writer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Put SW6(1-4) dip switch to 0100 and SW1 to off.
The terminal should show the following output:</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>-- Load Program to SystemRAM ---------------
please send</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Type "CTRL+A S" and select upload method "ascii".
Then choose file for uploading e.g.
<code>AArch32_Flash_writer_SCIF_DUMMY_CERT_E6300400_m3ulcb.mot</code>.
After upload finished press any key.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Step 2<br>
First flash the bootparam_sa0.srec.
n console execute <code>xls2</code> command (load program to hyper flash) and provide the following inputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>1
y
y
y
e6320000
0
type "ctrl+A S" and select upload method "ascii", then choose file for uploading
"bootparam_sa0.srec", after upload finished press any key
y</pre>
</div>
</div>
<div class="paragraph">
<p>Step 3<br>
Next flash the ipl1.srec.
In console execute <code>xls2</code> command (load program to hyper flash) and provide the following inputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>1
y
y
y
e6302000
40000
type "ctrl+A S" and select upload method "ascii", then choose file for uploading
"ipl1.srec", after upload finished press any key
y</pre>
</div>
</div>
<div class="paragraph">
<p>Step 4<br>
Next flash the bl2.srec.
In console execute <code>xls2</code> command (load program to hyper flash) and provide the following inputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>1
y
y
y
e6330000
1c0000
type "ctrl+A S" and select upload method "ascii", then choose file for uploading
"bl2.srec", after upload finished press any key
y</pre>
</div>
</div>
<div class="paragraph">
<p>Step 5<br>
Next flash the bl31.srec.
In console execute <code>xls2</code> command (load program to hyper flash) and provide the following inputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>1
y
y
y
44000000
200000
type "ctrl+A S" and select upload method "ascii", then choose file for uploading
"bl31.srec", after upload finished press any key
y</pre>
</div>
</div>
<div class="paragraph">
<p>Step 6<br>
Next flash the u-boot-elf-h3ulcb.srec.
In console execute <code>xls2</code> command (load program to hyper flash) and provide the following inputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>1
y
y
y
50000000
640000
type "ctrl+A S" and select upload method "ascii", then choose file for uploading
"u-boot-elf-h3ulcb.srec", after upload finished press any key
y</pre>
</div>
</div>
<div class="paragraph">
<p>Step 7<br>
Put SW6(1-4) dip switch to 1010, then power off and on the hw.
If the firmware is booting correctly, the output should look like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>NOTICE:  (IPL1) BL2: DDR3200(rev.0.37)
NOTICE:  (IPL1) BL2: [COLD_BOOT]
NOTICE:  (IPL1) BL2: DRAM Split is OFF
NOTICE:  (IPL1) BL2: QoS is default setting(rev.0.21)
NOTICE:  (IPL1) BL2: DRAM refresh interval 1.95 usec
NOTICE:  (IPL1) BL2: Periodic Write DQ Training
[    0.000112] NOTICE:  BL2: R-Car H3 Initial Program Loader(CA53)
[    0.004553] NOTICE:  BL2: Initial Program Loader(Rev.2.0.4)
[    0.010085] NOTICE:  BL2: PRR is R-Car H3 Ver.2.0
[    0.014754] NOTICE:  BL2: Board is Starter Kit Rev.1.0
[    0.019851] NOTICE:  BL2: Boot device is QSPI Flash(40MHz)
[    0.025285] NOTICE:  BL2: LCM state is CM
[    0.029276] NOTICE:  BL2: v1.5(release):rc_1_3.0.0-dirty
[    0.034515] NOTICE:  BL2: Built : 09:54:45, Nov  1 2019
[    0.039702] NOTICE:  BL2: Normal boot
[    0.043346] NOTICE:  BL2: dst=0xe633b100 src=0x8180000 len=512(0x200)
[    0.049838] NOTICE:  BL2: dst=0x43f00000 src=0x8180400 len=6144(0x1800)
[    0.057621] NOTICE:  BL2: dst=0x44000000 src=0x8200000 len=65536(0x10000)
[    0.077097] NOTICE:  BL2: dst=0x50000000 src=0x8640000 len=1048576(0x100000)
[    0.307195] NOTICE:  BL2: Booting BL31


U-Boot 2018.09 (Jul 29 2019 - 14:16:12 +0000)

CPU: Renesas Electronics R8A7795 rev 2.0
Model: Renesas H3ULCB board based on r8a7795 ES2.0+
DRAM:  3.9 GiB
Bank #0: 0x048000000 - 0x07fffffff, 896 MiB
Bank #1: 0x500000000 - 0x53fffffff, 1 GiB
Bank #2: 0x600000000 - 0x63fffffff, 1 GiB
Bank #3: 0x700000000 - 0x73fffffff, 1 GiB

MMC:   sd@ee100000: 0, sd@ee140000: 1
Loading Environment from MMC... OK
In:    serial@e6e88000
Out:   serial@e6e88000
Err:   serial@e6e88000
Net:   eth0: ethernet@e6800000
Hit any key to stop autoboot:  0
=&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="System_Analysis">2.7. 系统分析</h3>
<div class="paragraph">
<p>本章会介绍如何使用一些工具来进行测试，理解EB xelor软件所执行的动作。</p>
</div>
<div class="sect3">
<h4 id="_dlt_viewer">2.7.1. DLT Viewer</h4>
<div class="paragraph">
<p>DLT Viewer 是GENIVI提供的带GUI界面的运行时DLT消息虚拟化 <a href="https://github.com/GENIVI/dlt-viewer">open-source software</a></p>
</div>
<div class="paragraph">
<p>和其他软件一样，DLT viewer也由Conan打包，开发者可以很容易的获取。目前支持 Linux 和 Windows 系统。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>DLT Viewer needs a graphical server to run, which the current Docker
image used for development purposes does not offer. You will be able
to retrieve the package, but must step out of the container before
using it. You will <em>also</em> need to install Qt libraries into your Linux
host, e.g. for an Ubuntu-based distro:
<code>sudo apt-get install qt5-default libqt5serialport5-dev</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>对于DLT以及DLT viewer使用方法，请参阅
<a href="https://github.com/GENIVI/dlt-viewer/blob/v2.20.0/doc/dlt_viewer_user_manual.pdf">
official user guide.</a></p>
</div>
<div class="paragraph">
<p>DLT viewer的安装:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#Install_DLT_Viewer_Linux">Installing DLT Viewer on Linux</a></p>
</li>
<li>
<p><a href="#Install_DLT_Viewer_Windows">Installing DLT Viewer on Windows</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="Install_DLT_Viewer_Linux">Installing DLT Viewer on Linux</h5>
<div class="paragraph">
<p>We assume you already <a href="#Obtain">obtained a copy of EB xelor.</a> You should
then use the following command <em>after</em> <a href="#Docker">running the EB xelor
Docker container.</a></p>
</div>
<div class="paragraph">
<p>Then, assuming you would like to install in <code>my_dltviewer_install/</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>conan install \
    -if my_dltviewer_install  \
    -pr config/valeria/native/profiles/linux_x86_64 \
    -pr config/valeria/native/profiles/gcc \
    -r eb_core-releases \
    eb_dltviewer/0.1.1@EBxelor/2020.12</pre>
</div>
</div>
<div class="paragraph">
<p>All binaries (ELF executable, libraries, and DLT Viewer plugins)
are laid flat into <code>my_dltviewer_install/</code>. To run it, you will
need to update <code>LD_LIBRARY_PATH</code> (e.g. in your bashrc):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd my_dltviewer_install/
LD_LIBRARY_PATH="$LD_LIBRARY_PATH":$(pwd) ./dlt-viewer</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You won&#8217;t be able to install DLT Viewer to a standard path like
<code>/usr/bin/</code> from the (unprivileged and chrooted) Docker container.
Hence the local deployment instead. Feel free to manually copy
binaries in your system afterwards, though.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_compiling_dlt_viewer_on_linux">Compiling DLT Viewer on Linux</h5>
<div class="paragraph">
<p>The EB xelor Docker environment is already equipped for building
DLT Viewer natively. Use Valeria with a simple build manifest
for the "native" target, or use Conan directly.</p>
</div>
</div>
<div class="sect4">
<h5 id="Install_DLT_Viewer_Windows">Installing DLT Viewer on Windows</h5>
<div class="paragraph">
<p>We assume you already <a href="#Obtain">obtained a copy of EB xelor.</a>
We also assume you already  <a href="#Install_Conan_Windows">installed Conan for Windows.</a>
If not, please do this beforehand.</p>
</div>
<div class="paragraph">
<p>Then, assuming you would like to install in <code>C:\DltViewer\</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>conan install \
    -if "C:\DltViewer" \
    -pr config/valeria/native/profiles/windows_x86_64 \
    -pr config/valeria/native/profiles/visual_studio \
    -r eb_core-releases \
    eb_dltviewer/0.1.1@EBxelor/2020.12</pre>
</div>
</div>
<div class="paragraph">
<p>You can then launch DLT Viewer directly by double-clicking on
the executable, as usual.</p>
</div>
</div>
<div class="sect4">
<h5 id="_compiling_dlt_viewer_on_windows">Compiling DLT Viewer on Windows</h5>
<div class="paragraph">
<p>At the moment, no Windows Docker environment is available
for developers, so you will have to use the CI ("native"
Windows build manifest for Valeria), or install the toolchains
yourself.</p>
</div>
<div class="paragraph">
<p>When opting for the latter, here is what you need to do:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install Qt 5.12.4
(<a href="http://download.qt.io/official_releases/qt/5.12/5.12.4/qt-opensource-windows-x86-5.12.4.exe.mirrorlist">
link to official installer</a>)</p>
</li>
<li>
<p>Install Visual Studio 2017 Community 15.9
(<a href="https://my.visualstudio.com/Downloads?q=Visual%20Studio%202017">
you can find it in this list</a>) Using the graphical installer wizard:</p>
<div class="ulist">
<ul>
<li>
<p>Tick "Desktop development with C <em>plus plus</em>" on the panel you&#8217;re
first shown (toolsets selections)</p>
</li>
<li>
<p>This should be enough to get all necessary components</p>
</li>
</ul>
</div>
</li>
<li>
<p>Use the regular Conan workflow in a Powershell</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before starting, you should set <code>QTDIR</code> and <code>MSVC_DIR</code> to
the appropriate install paths. On Powershell, you can do this
using <code>$env:QTDIR = "path"</code> and <code>$env:MSVC_DIR = "path"</code>. For the
record, if you kept default you should have something like the
following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>C:\Qt\Qt5.12.4\5.12.4\msvc2017_64
C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC</pre>
</div>
</div>
<div class="paragraph">
<p>You may then call <code>conan source|install|build|package</code> as usual.</p>
</div>
</div>
<div class="sect4">
<h5 id="_sample_project_file">Sample project file</h5>
<div class="paragraph">
<p>DLT Viewer stores both global and project-specific settings in
<em>.dlp</em> files. Those describe the expected ECUs, how to connect
to them, and possibly additional filters and plugins.</p>
</div>
<div class="paragraph">
<p>You can find a generic project file in
<em>/tools/dlt_viewer/DLT_DefaultCfg.dlp</em> in the project
sources. We suggest you start from it to build your own
detailed configuration, to suit your needs. This project file
offers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Default settings</p>
</li>
<li>
<p>Listing of ECUs</p>
<div class="ulist">
<ul>
<li>
<p>"Adaptive" virtual machines (<em>alpha</em> and <em>beta</em>)</p>
</li>
<li>
<p>"Classic" firmware (<em>real-time reference app</em>)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Basic filters</p>
<div class="ulist">
<ul>
<li>
<p>System journal, Execution Manager activity and "Get Software
Version" requests for Adaptive virtual machines</p>
</li>
<li>
<p>All warnings</p>
</li>
<li>
<p>All errors / fatal errors</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_dlt_identifiers_for_eb_xelor">DLT identifiers for EB xelor</h5>
<div class="paragraph">
<p>The following are essential identifiers describing ECUs and
a few applications. They form a small basis, and should be
made more diverse in the future. Please update them if you
happen to change or add some.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. List of ECUs</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ECU ID</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RTRA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Real-Time Reference Application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALPH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux Adaptive AUTOSAR VM "alpha"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BETA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux Adaptive AUTOSAR VM "alpha"</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. List of specific DLT contexts</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ECU ID</th>
<th class="tableblock halign-left valign-top">APP ID</th>
<th class="tableblock halign-left valign-top">CTX ID</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RTRA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CYCL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TIMG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cyclic counter transferred over the various networks, and also over DLT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALPH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>N/A</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Demo application "SensorHandler"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALPH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JOUR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EB Linux journal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALPH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adaptive Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>N/A</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Please refer to the appropriate section in ADG user&#8217;s manual,
which can be found
<a href="https://gitext.elektrobitautomotive.com/EB-corbos-AdaptiveCore/ara-corbos-AdaptiveCore-deliveries">here</a>
at the moment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BETA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>N/A</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Demo application "SensorPreprocessor"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BETA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JOUR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EB Linux journal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BETA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adaptive Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>N/A</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Please refer to the appropriate section in ADG user&#8217;s manual,
which can be found
<a href="https://gitext.elektrobitautomotive.com/EB-corbos-AdaptiveCore/ara-corbos-AdaptiveCore-deliveries">here</a>
at the moment</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_licensing">Licensing</h5>
<div class="paragraph">
<p>It <em>shall</em> be possible to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use DLT Viewer <em>internally</em></p>
</li>
<li>
<p>Redistribute DLT Viewer for use <em>internally</em> and by <em>customers</em></p>
<div class="ulist">
<ul>
<li>
<p>Customers can be provided the full binary package (DLT Viewer
+ Qt libraries)</p>
</li>
<li>
<p>Customers can be provided only DLT Viewer binary + guidance
regarding Qt installation</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details about licensing, please take a look at the
<em>/pkg/eb_dltviewer/LICENSE.adoc</em> file stored along the package
source.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_eb_xelor详细介绍">3. EB xelor详细介绍</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Firmware">3.1. Firmware for R-Car H3</h3>
<div class="paragraph">
<p>EB xelor 提供 R-Car H3 firmware bin文件的Conan包。</p>
</div>
<div class="sect3">
<h4 id="_获取bin文件">3.1.1. 获取bin文件</h4>
<div class="paragraph">
<p><strong>前提条件:</strong><br>
已安装Conan, 详细请参考 <a href="#Docker">Docker</a>.</p>
</div>
<div class="paragraph">
<p>如果不用 <a href="#Valeria">Valeria - 构建完整EB xelor软件包</a> 来构建, 需要注意的是Conan profile使用conan user和connan channel。
你需要在 <code>config/valeria/r-car-h3/profiles</code> 目录下创建 <code>get_user_channel</code> 文件并指定user 和 channel。
例如：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CONAN_USER=EBxelor
CONAN_CHANNEL=2020.12</pre>
</div>
</div>
<div class="paragraph">
<p>Step 1<br>
在EB xelor artifactory中搜索所有firmware的包. E.g. firmware:</p>
</div>
<div class="paragraph">
<p><code>conan search -r eb_core-releases *eb_firmware*</code></p>
</div>
<div class="paragraph">
<p>Step 2<br>
创建空白目录并从EB xelor artifactory获取二进制文件。例如：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mkdir firmware
cd firmware
conan install \
--profile:host=\
/workdir/EBxelor-2020.12/config/valeria/r-car-h3/profiles/host/gcc7_arm64 \
--profile:host=\
/workdir/EBxelor-2020.12/config/valeria/r-car-h3/profiles/host/A5x \
--profile:build=\
/workdir/EBxelor-2020.12/config/valeria/r-car-h3/profiles/build/linux_x86_64 \
-r eb_core-releases eb_firmware/0.1.1@EBxelor/2020.12</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>当前firmware包包含R7和A5x的文件。后续版本会将他们分开打包。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Step 3<br>
检查目录下已有对应的文件：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>firmware-H3-4GB
firmware-H3-8GB</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_各个文件的描述">3.1.2. 各个文件的描述</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">文件</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bl2.elf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Perform platform security setup to allow access to controlled components, started vom IPL1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bl2.map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bl2 map file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bl2.srec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bl2 in srec format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bl31.elf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Started by the bl2, initializes power modes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bl31.map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bl31 map file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bl31.srec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bl31 in srec format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootparam_sa0.srec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">???</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cert_header_sa6.srec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificate header of the IPL1, checked by the boot ROM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ipl1.elf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">first part that is started</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ipl1.map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ipl1 map file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ipl1.srec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ipl1 in srec format</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_配置">3.1.3. 配置</h4>
<div class="paragraph">
<p>firmware文档中有使用到的地址的描述。
firmware以二进制文件形式交付。</p>
</div>
</div>
<div class="sect3">
<h4 id="_flashing_to_h3">3.1.4. Flashing to H3</h4>
<div class="paragraph">
<p>参考 <a href="#Flashing">烧写</a> 已了解如何烧写。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="EBLinux">3.2. EB corbos Linux</h3>
<div class="paragraph">
<p>EB xelor 提供 EB corbos Linux bin文件的Conan包。</p>
</div>
<div class="sect3">
<h4 id="_获取镜像文件">3.2.1. 获取镜像文件</h4>
<div class="paragraph">
<p><strong>前提条件:</strong><br>
已安装Conan, 详细请参考 <a href="#Docker">Docker</a>.</p>
</div>
<div class="paragraph">
<p>如果不用 <a href="#Valeria">Valeria - 构建完整EB xelor软件包</a> 来构建, 需要注意的是Conan profile使用conan user和connan channel。
你需要在 <code>config/valeria/r-car-h3/profiles</code> 目录下创建 <code>get_user_channel</code> 文件并指定user 和 channel。
例如：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CONAN_USER=EBxelor
CONAN_CHANNEL=2020.12</pre>
</div>
</div>
<div class="paragraph">
<p>Step 1<br>
在EB xelor artifactory中搜索所有EB corbos Linux的包.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>conan search -r eb_core-releases eb_linux*</pre>
</div>
</div>
<div class="paragraph">
<p>Step 2<br>
创建空白目录并从EB xelor artifactory获取镜像文件。</p>
</div>
<div class="paragraph">
<p>For R-Car H3:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mkdir linux
cd linux
conan install \
--profile:host=\
/workdir/EBxelor-2020.12/config/valeria/r-car-h3/profiles/host/A5x \
--profile:build=\
/workdir/EBxelor-2020.12/config/valeria/r-car-h3/profiles/build/linux_x86_64 \
--profile:build=\
/workdir/EBxelor-2020.12/config/valeria/r-car-h3/profiles/build/soc_specific \
-r eb_core-releases eb_linux/0.3.0@EBxelor/2020.12</pre>
</div>
</div>
<div class="paragraph">
<p>For NXP S32G:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mkdir linux
cd linux
conan install \
--profile:host=\
/workdir/EBxelor-2020.12/config/valeria/s32g/profiles/host/A53 \
--profile:build=\
/workdir/EBxelor-2020.12/config/valeria/s32g/profiles/build/linux_x86_64 \
--profile:build=\
/workdir/EBxelor-2020.12/config/valeria/s32g/profiles/build/soc_specific \
-r eb_core-releases eb_linux/0.3.0@EBxelor/2020.12</pre>
</div>
</div>
<div class="paragraph">
<p>Now the linux directory contains the following binaries:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>EB_linux_base__core-image-eb-dev-corbos-*-hv.wic
bootstrap.uimage
Image
sdk/corbos-linux-glibc-x86_64-core-image-eb-dev-aarch64-corbos\
-*-hv-toolchain-*.sh</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>yocto-sdk (corbos-linux-glibc-x86_64-core-image-eb-dev-aarch64-corbos&#8230;&#8203;) 包含linux版本信息.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_各个文件的描述_2">3.2.2. 各个文件的描述</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">文件</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EB_linux_base__core-image-eb-dev-corbos-*-hv.wic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EB corbos Linux disk image</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrap.uimage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u-boot legacy uImage with Linux kernel image<br>
Needed for Hypervisor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EB corbos Linux image</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">core-image-eb-dev-corbos-*-hv.squashfs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Root filesystem<br>
Needed for Hypervisor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sdk/corbos-linux-glibc-x86_64-core-image-eb-dev-aarch64-corbos-*.sh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yocto SDK generated from the build</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_配置_2">3.2.3. 配置</h4>
<div class="paragraph">
<p><strong>网络配置</strong></p>
</div>
<div class="paragraph">
<p>EB corbos Linux 网络配置分为两部分:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hostname comes from Hypervisor as kernel parameter (see more info from <a href="#Hypervisor">EB corbos Hypervisor</a> instructions)</p>
</li>
<li>
<p>IP addresses (IPv4 and IPv6) are configured in files:</p>
<div class="ulist">
<ul>
<li>
<p><code>pkg/eb_linux/yocto/meta-ebcore/recipes-networking/<br>
system-network/system-network/network.json</code>
`</p>
</li>
<li>
<p>After changing <code>network*.json</code> files, rebuild EB corbos Linux, it generates script <code>/sbin/network-config.sh</code> which is executed during EB corbos Linux boot</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The EB xelor provides a Yocto meta layer to configure the EB linux.
The meta layer is located in this directory:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>pkg/eb_linux/yocto/meta-ebcore</pre>
</div>
</div>
<div class="paragraph">
<p>The purpose of the yocto layer is a clear separation of the EB xelor specific configuration from the EB products.</p>
</div>
</div>
<div class="sect3">
<h4 id="_yoctos_sstate_cache的使用">3.2.4. yocto&#8217;s sstate-cache的使用</h4>
<div class="paragraph">
<p>The usage of yocto&#8217;s sstate-cache can speed up the build process significantly after an initial build.
Read the <a href="https://wiki.yoctoproject.org/wiki/Enable_sstate_cache">yocto manual</a> for more information about the sstate-cache.</p>
</div>
<div class="paragraph">
<p>The Linux recipe <code>pkg/eb_linux/conan/conanfile.py</code> configures the cache based on the following environment variables.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. eb_linux recipe 中 sstate-cache configuration使用的环境变量</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">环境变量</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SSTATE_DIR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/my-local-cache/sstate-cache</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The directory of the local sstate-cache</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SSTATE_MIRRORS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="file://.*" class="bare">file://.*</a> <a href="http://sstate-cache.my.domain/PATH" class="bare">http://sstate-cache.my.domain/PATH</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address of the remote sstate-cache server</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A typical setup is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>After a clean build, the <code>SSTATE_DIR</code> directory contains the sstate files.</p>
</li>
<li>
<p>These files are uploaded to the <code>SSTATE_MIRRORS</code> server to share those with other build machines.</p>
</li>
<li>
<p>Also in subsequent builds, newly generated files in <code>SSTATE_DIR</code> are uploaded to the server.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_烧写到_h3">3.2.5. 烧写到 H3</h4>
<div class="paragraph">
<p>Flashing to the target can be done manually or with the flashing library.
The steps are described in <a href="#Flashing">烧写</a> chapters.</p>
</div>
<div class="paragraph">
<p>Write card image to SD card with dd (replace "sdX" with your SD card device, e.g. "sdc")</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo dd if=EB_linux_base__core-image-eb-dev-corbos-h3ulcb-hv.wic \
  of=/dev/sdX bs=64M</pre>
</div>
</div>
<div class="paragraph">
<p>Insert SD card to target, reboot target, interrupt the u-boot and boot the hypervisor image:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>=&gt; ext2load mmc 0:1 0x50FFFFC0 bootstrap.uimage
40633584 bytes read in 931 ms (41.6 MiB/s)
=&gt; bootm 0x50FFFFC0</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Hypervisor">3.3. EB corbos Hypervisor</h3>
<div class="paragraph">
<p>EB xelor 提供 EB corbos Hypervisor bin文件的Conan包。</p>
</div>
<div class="sect3">
<h4 id="_获取镜像文件_2">3.3.1. 获取镜像文件</h4>
<div class="paragraph">
<p><strong>前提条件:</strong><br>
已安装Conan, 详细请参考 <a href="#Docker">Docker</a>.</p>
</div>
<div class="paragraph">
<p>如果不用 <a href="#Valeria">Valeria - 构建完整EB xelor软件包</a> 来构建, 需要注意的是Conan profile使用conan user和connan channel。
你需要在 <code>config/valeria/r-car-h3/profiles</code> 目录下创建 <code>get_user_channel</code> 文件并指定user 和 channel。
例如：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CONAN_USER=EBxelor
CONAN_CHANNEL=2020.12</pre>
</div>
</div>
<div class="paragraph">
<p>Step 1<br>
在EB xelor artifactory中搜索所有EB corbos Hypervisor的包.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>conan search -r eb_core-releases eb_hypervisor*</pre>
</div>
</div>
<div class="paragraph">
<p>Step 2<br>
创建空白目录并从EB xelor artifactory获取镜像文件</p>
</div>
<div class="paragraph">
<p>For R-Car-H3:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mkdir hypervisor
cd hypervisor
conan install \
--profile:host=\
/workdir/EBxelor-2020.12/config/valeria/r-car-h3/profiles/host/A5x \
--profile:build=\
/workdir/EBxelor-2020.12/config/valeria/r-car-h3/profiles/build/linux_x86_64 \
--profile:build=\
/workdir/EBxelor-2020.12/config/valeria/r-car-h3/profiles/build/soc_specific \
-r eb_core-releases eb_hypervisor/0.3.1@EBxelor/2020.12</pre>
</div>
</div>
<div class="paragraph">
<p>For NXP S32G:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mkdir hypervisor
cd hypervisor
conan install \
--profile:host=\
/workdir/EBxelor-2020.12/config/valeria/s32g/profiles/host/A53 \
--profile:build=\
/workdir/EBxelor-2020.12/config/valeria/s32g/profiles/build/linux_x86_64 \
--profile:build=\
/workdir/EBxelor-2020.12/config/valeria/s32g/profiles/build/soc_specific \
-r eb_core-releases eb_hypervisor/0.3.1@EBxelor/2020.12</pre>
</div>
</div>
<div class="paragraph">
<p>现在， <code>hypervisor/eb_hypervisor_r-car-h3/</code> 目录将包含这些文件：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>EBcore-boot.img
EBcore-containers.img
EBcore-data.img
EBcore-rootfs.img</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_各个文件的描述_3">3.3.2. 各个文件的描述</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">文件</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EBcore-boot.img</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains bootstrap.uimage. Used if the hypervisor is started form emmc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EBcore-rootfs.img</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Root file system for VM2 and VM3 running on EB corbos Linux</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EBcore-containers.img</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container partitions for VM2 and VM3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EBcore-data.img</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data partitions for VM2 and VM3</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_配置_3">3.3.3. 配置</h4>
<div class="sect4">
<h5 id="_eb_corbos_linux_hostname">EB corbos Linux hostname</h5>
<div class="paragraph">
<p>修改文件: <code>pkg/eb_hypervisor/config/setup_vm.ned</code>. Hostname 在这些行中定义 (当前名称为 EBcore-vm-alpha 和 EBcore-vm-beta):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>local vm_2_bootargs = " root=/dev/vda rootwait ro hostname=ebcore-vm-alpha" ..

local vm_3_bootargs = " root=/dev/vda rootwait ro hostname=ebcore-vm-beta" ..</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_hypervisors_vm1_bridges_ip">Hypervisor&#8217;s vm1 bridge&#8217;s IP</h5>
<div class="paragraph">
<p>Mount ramdisk</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo mkdir /mnt/hv_ramdisk
sudo mount pkg/eb_hypervisor/config/ramdisk-vm.rd \
  /mnt/hv_ramdisk</pre>
</div>
</div>
<div class="paragraph">
<p>Change IP address in file:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo nano /mnt/hv_ramdisk/etc/network/interfaces-bridge</pre>
</div>
</div>
<div class="paragraph">
<p>Save and umount</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo umount /mnt/hv_ramdisk</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_vm_hub_hostname">vm-hub hostname</h5>
<div class="paragraph">
<p>Mount ramdisk</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo mkdir /mnt/hv_ramdisk
sudo mount pkg/eb_hypervisor/config/ramdisk-vm.rd \
  /mnt/hv_ramdisk</pre>
</div>
</div>
<div class="paragraph">
<p>Change vm-hub hostname in file:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo nano /mnt/hv_ramdisk/etc/hostname</pre>
</div>
</div>
<div class="paragraph">
<p>Save and umount</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo umount /mnt/hv_ramdisk</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_使用方法">使用方法</h5>
<div class="paragraph">
<p>Hypervisor 支持下列键盘命令:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">命令</th>
<th class="tableblock halign-left valign-top">动作</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ctrl-E .</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disconnect (goes to Hypervisor console)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ctrl-E 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connect to console 'vm1' (vm-hub)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ctrl-E 2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connect to console 'vm2' (ebcore-vm-alpha)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ctrl-E 3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connect to console 'vm3' (ebcore-vm-beta)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_烧写到_h3_2">3.3.4. 烧写到 H3</h4>
<div class="paragraph">
<p>Subject to change.
Flashing will be changed in some point, but currently flashing contains two separate steps.</p>
</div>
<div class="paragraph">
<p>Step 1<br>
Hardware needs to be prepared for flashing.
Make sure that you have the latest u-boot, which supports fastboot (can be found in EB xelor artifactory).</p>
</div>
<div class="paragraph">
<p>Stop u-boot, and give following commands:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>setenv vm2_partition 'name=boot,start=1MiB,size=50MiB;name=rootfs, \
  size=64MiB;name=data,size=480MiB;name=containers,size=512MiB;'
setenv vm3_partition 'name=rootfs2,size=64MiB;name=data2, \
  size=480MiB;name=containers2,size=512MiB;'
setenv partitions $vm2_partition$vm3_partition
setenv bootcmd 'ext4load mmc 1:1 0x50FFFFC0 bootstrap.uimage; bootm 0x50FFFFC0'
saveenv

fastboot udp</pre>
</div>
</div>
<div class="paragraph">
<p>Output should be like that:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Using ethernet@e6800000 device
Listening for fastboot command on 192.168.7.14</pre>
</div>
</div>
<div class="paragraph">
<p>Step 2<br>
Goto directory were the hypervisor binaries where installed</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd hypervisor/eb_hypervisor_r-car-h3/</pre>
</div>
</div>
<div class="paragraph">
<p>Give <code>./flash_emmc.sh &lt;ip-address&gt;</code> command.
ip-address is the same as the one hw is listening to, see output from Step 1.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>./flash_emmc.sh 192.168.7.14</pre>
</div>
</div>
<div class="paragraph">
<p>After flashing script is done, hardware should boot automatically to hypervisor.
And the user can login to VM&#8217;s:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>vm2     :
vm2     | corbos 1.13.0 EBcore-vm2 hvc1
vm2     |
vm2     | EBcore-vm2 login:
vm1     : [   10.390488] ravb e6800000.ethernet eth2: Link is Up -
                                        100Mbps/Full - flow control rx/tx
vm1     | [   10.403145] IPv6: ADDRCONF(NETDEV_CHANGE): eth2: link becomes ready
vm1     | [   10.413330] br0: port 3(eth2) entered blocking state
vm1     | [   10.421371] br0: port 3(eth2) entered forwarding state
vm3     |
vm3     | corbos 1.13.0 EBcore-vm3 hvc0
vm3     |
vm3     |
vm3     | corbos 1.13.0 EBcore-vm3 hvc1
vm3     |
vm3     | EBcore-vm3 login:</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="EB_ADG">3.4. EB corbos AdaptiveCore</h3>
<div class="paragraph">
<p>The EB corbos AdaptiveCore is based on the AUTOSAR Adaptive Platform specification and contains hardware-independent
Adaptive Platform components and the run-time environment for adaptive applications.
EB-specific enhancements that are compatible to the AUTOSAR Adaptive standard are implemented.
EB corbos AdaptiveCore is the software base for safe and secure high-performance controllers.</p>
</div>
<div class="paragraph">
<p>When building the EB ADG modules the Yocto SDK toolchain provided by the EB xelor is used.</p>
</div>
<div class="paragraph">
<p>The open source libraries needed by the ADG are also included.</p>
</div>
<div class="sect3">
<h4 id="_building_the_adg">3.4.1. Building the ADG</h4>
<div class="paragraph">
<p><strong>Prerequisite:</strong><br>
Conan is installed on your workplace, for details see <a href="#Docker">Docker</a></p>
</div>
<div class="paragraph">
<p>In case you did not use <a href="#Valeria">Valeria - 构建完整EB xelor软件包</a> to build, please note that the conan profiles are using conan user and channel.
You need to create a file called <code>get_user_channel</code> in folder <code>config/valeria/r-car-h3/profiles</code> specifying user and channel.
In this example we use user <code>EBxelor</code> and channel <code>2020.12</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CONAN_USER=EBxelor
CONAN_CHANNEL=2020.12</pre>
</div>
</div>
<div class="paragraph">
<p>Step 1<br>
Search all available EB corbos AdaptiveCore packages from the EB xelor artifactory</p>
</div>
<div class="literalblock">
<div class="content">
<pre>conan search -r eb_core-releases eb_adg*</pre>
</div>
</div>
<div class="paragraph">
<p>Step 2<br>
Create an empty directory and install the eb_adg from the EB xelor artifactory.
Replace version number and user/channel in the call in case you want to download other versions.</p>
</div>
<div class="paragraph">
<p>For R-Car H3:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mkdir eb_adg
cd eb_adg
conan install \
--profile:host=\
/workdir/EBxelor-2020.12/config/valeria/r-car-h3/profiles/host/A5x \
--profile:host=\
/workdir/EBxelor-2020.12/config/valeria/r-car-h3/profiles/host/eb_linux \
--profile:build=\
/workdir/EBxelor-2020.12/config/valeria/r-car-h3/profiles/build/linux_x86_64 \
--profile:build=\
/workdir/EBxelor-2020.12/config/valeria/r-car-h3/profiles/build/soc_specific \
-r eb_core-releases eb_adg/0.5.1@EBxelor/2020.12</pre>
</div>
</div>
<div class="paragraph">
<p>For NXP S32G:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mkdir eb_adg
cd eb_adg
conan install \
--profile:host=\
/workdir/EBxelor-2020.12/config/valeria/s32g/profiles/host/A53 \
--profile:host=\
/workdir/EBxelor-2020.12/config/valeria/s32g/profiles/host/eb_linux \
--profile:build=\
/workdir/EBxelor-2020.12/config/valeria/s32g/profiles/build/linux_x86_64 \
--profile:build=\
/workdir/EBxelor-2020.12/config/valeria/s32g/profiles/build/soc_specific \
-r eb_core-releases eb_adg/0.5.1@EBxelor/2020.12</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_description_of_binary_files">3.4.2. Description of binary files</h4>
<div class="paragraph">
<p>For a description of the files placed in the directories of the ADG modules please have a look into the ADG documentation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_building_the_adg_2">3.4.3. Building the ADG</h4>
<div class="paragraph">
<p>For building the ADG the ara-cli is used.
The EB xelor Yocto SDK is defined as custom toolchain.</p>
</div>
<div class="paragraph">
<p>The ADG provides patch files to fix errors in the ADG modules.
They are located in</p>
</div>
<div class="literalblock">
<div class="content">
<pre>pkg/eb_adg/patch</pre>
</div>
</div>
<div class="paragraph">
<p>For building the ADG additional modules are needed in the EB linux image.
Therefore some packages are added to the EB linux build and to the yocto-SDK</p>
</div>
<div class="literalblock">
<div class="content">
<pre>pkg/eb_linux/yocto/meta-ebcore/ \
recipes-images/images/core-image-eb-dev.bbappend</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_adg_containers">3.4.4. ADG containers</h4>
<div class="paragraph">
<p>The conan recipe <code>eb_adg_containers</code> takes the binaries from the <code>eb_adg</code> package and puts them into containers for EB corbos Linux.
With the flashing library, these containers can be installed on the target to start the ADG.</p>
</div>
<div class="paragraph">
<p>The installation of the containers also installs systemd service files for the ADG daemons.
They are started by default during startup.
You can check if the daemons are running using <code>systemctl</code>.
E.g. for the com daemon:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>systemctl status com-daemon-container</pre>
</div>
</div>
<div class="paragraph">
<p>In case daemons are not starting, e.g. due to wrong configuration, you shall check the logs.
E.g. for the com daemon:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>journalctl -u com-daemon-container</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="EBtresos">3.5. EB tresos以及示例程序RT_RefApp指南</h3>
<div class="paragraph">
<p>EB xelor 提供 EB tresos AutoCore文件以及CP示例程序RT_RefApp的Conan包。</p>
</div>
<div class="sect3">
<h4 id="_概述_2">3.5.1. 概述</h4>
<div class="paragraph">
<p>本节介绍如何在Windows平台搭建Conan，使用Conan recipe构建/安装ET tresos和RT_RefApp。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
目前EB tresos studio仅支持Windows。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>EB tresos AutoCore 组件:</strong></p>
</div>
<div class="paragraph">
<p>ACP, MCAL, ACG, and Generic modules-update</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="5978760A-28DC-4231-A04F-6752787DD6ED.png" alt="Architecture"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="Install_Conan_Windows">3.5.2. 在Windows平台安装Conan</h4>
<div class="paragraph">
<p>As EB tresos AutoCore and RT_RefApp run only on Windows OS.
We need to set the Conan client on the Windows machine.
EB tresos AutoCore is packaged as EB tresos conan recipes in EB xelor.
Prerequisite: We assume that a bash shell is used, e.g. git-bash or cygwin.</p>
</div>
<div class="paragraph">
<p><strong>Python安装:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Download the OS corresponding python installer from <a href="https://www.python.org/" class="bare">https://www.python.org/</a>.
At least python version 3.8 is required.</p>
</li>
<li>
<p>Install python in the folder <code>C:\Tools\</code> (you can choose another directory)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Conan安装:</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ python -m pip install -r tools/valeria/requirements.txt</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For more Conan installation detail, please refer to <a href="https://docs.conan.io/en/latest/installation.html" class="bare">https://docs.conan.io/en/latest/installation.html</a>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The path length limitation shall be disabled.<br>
<code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\FileSystem</code>
<code>LongPathsEnabled</code> shall be equal to 0x00000001
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Even with the previous configuration, the build of EB tresos applications can fail due to long
path names. This can be avoided by using conan feature to force short path names. Set the environment
variables <code>CONAN_USER_HOME_SHORT="C:\path\to\local-short-name-cache"</code>
and <code>CONAN_USE_ALWAYS_SHORT_PATHS="True"</code> to activate this.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>安装Conan配置:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Get the EB xelor sources, see <a href="#Obtain">获取EB xelor</a>.</p>
</li>
<li>
<p>Update the conan remote repositories, see <a href="#Configuration">配置</a>.</p>
</li>
<li>
<p>Go to the folder where the sources are located and run the Conan configuration installation:</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>$ conan config install config/conan/config
$ conan config install config/conan/config_ci</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Usually, the Conan configuration is installed in the local cache <code>C:\Users\&lt;User ID&gt;\.conan\</code><br>
You can use different caches by defining the environment variable <code>CONAN_USER_HOME</code><br>
Refer to <a href="https://docs.conan.io/en/latest/mastering/custom_cache.html" class="bare">https://docs.conan.io/en/latest/mastering/custom_cache.html</a>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the Conan username for the configured repositories:</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>$ conan user -r eb_core-releases &lt;artifactory's login&gt;
$ conan user -r eb_core-snapshots &lt;artifactory's login&gt;
$ conan user -r eb_core-devdrops &lt;artifactory's login&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If it requires the password, please enter the &lt;Artifactory’s login&gt;'s password.
In case you only have access to the <code>eb_core-releases</code> repository,
you should omit the <code>eb_core-snapshots</code> and <code>eb_core-devdrops</code> repository initialization,
see <a href="#Configuration">配置</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
When using cygwin, it can happen that the credentials are not stored by conan when
calling <code>conan user</code> from cygwin shell. In this case, please call the <code>conan user</code> command
from Windows command line first. Afterwards you can continue using cygwin.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Perform a Conan search command to make sure the result is returned:</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>$ conan search -r eb_core-releases</pre>
</div>
</div>
<div class="paragraph">
<p>The response should be similar to:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Please log in to "eb_core-releases" to perform this action.
Execute "conan user" command.
Please enter a password for "&lt;artifactory's login&gt;" account:
Existing package recipes:

eb_adg/0.1.0@EBxelor/2020.10
eb_adg/0.4.0@EBxelor/2020.12-pre1
...</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_install_jfrog_command_line_interface_in_windows">3.5.3. Install jfrog command line interface in Windows</h4>
<div class="paragraph">
<p>This is only necessary in case you want to rebuild EB xelor packages from source.
The incoming supplies for Tresos are stored in Artifactory and jfrog cli is used to access those.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>jfrog installation:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Download the jfrog from <a href="https://api.bintray.com/content/jfrog/jfrog-cli-go/$latest/jfrog-cli-windows-amd64/jfrog.exe?bt_package=jfrog-cli-windows-amd64">jfrog cli website</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set jfrog PATH:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Move jfrog.exe to your work directory: e.g. ../workspace/jfrog.exe<br>
Add the work directory of jfrog (e.g. ../workspace) into <code>Environment Variables&#8594;System variables&#8594;Path</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>jfrog configuration:</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>$ jfrog rt config --url=https://artifactory-central.elektrobit.com/ \
--user=EB_account_user --password=EB_account_password</pre>
</div>
</div>
<div class="paragraph">
<p>jfrog configuration on windows is equivalent to linux, please refer to <a href="#Docker">linux/docker configuration</a> section.</p>
</div>
<div class="sect4">
<h5 id="_build_the_eb_tresos_binaries">Build the EB tresos binaries</h5>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Please refer to <a href="#Valeria">Valeria - 构建完整EB xelor软件包</a> for building the whole EB tresos locally.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rt_refapp_installation_and_build">3.5.4. RT_RefApp installation and build</h4>
<div class="paragraph">
<p>RT_RefApp&#8217;s project configuration is stored in <code>pkg\eb_rt-refapp\workspace\</code></p>
</div>
<div class="sect4">
<h5 id="_getting_the_rt_refapp_binaries">Getting the RT_RefApp binaries</h5>
<div class="paragraph">
<p><strong>Prerequisite:</strong><br>
Conan setup on windows.</p>
</div>
<div class="paragraph">
<p>In case you did not use <a href="#Valeria">Valeria - 构建完整EB xelor软件包</a> to build, please note that the conan profiles are using conan user and channel.
You need to create a file called <code>get_user_channel</code> in folder <code>config/valeria/r-car-h3/profiles</code> specifying user and channel.
In this example we use user <code>EBxelor</code> and channel <code>2020.12</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CONAN_USER=EBxelor
CONAN_CHANNEL=2020.12</pre>
</div>
</div>
<div class="paragraph">
<p>Step 1<br>
Search all available RT_RefApp packages from EB xelor Artifactory:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ conan search -r eb_core-releases eb_rt-refapp</pre>
</div>
</div>
<div class="paragraph">
<p>The response should be similar to:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Existing package recipes:

eb_rt-refapp/0.3.5@EBxelor/2020.12
...</pre>
</div>
</div>
<div class="paragraph">
<p>Step 2<br>
Create empty directory and install EB tresos AutoCore binaries from EB xelor Artifactory.
Replace version number and user/channel in the call in case you want to download other versions.</p>
</div>
<div class="paragraph">
<p>For R-car H3:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ mkdir RT_RefApp
$ cd RT_RefApp
$ conan install --profile:build \
  ../EBxelor-2020.12/config/valeria/r-car-h3/profiles/build/windows_x86_64 \
  --profile:build \
  ../EBxelor-2020.12/config/valeria/r-car-h3/profiles/build/soc_specific \
  --profile:host \
  ../EBxelor-2020.12/config/valeria/r-car-h3/profiles/host/R7 \
  --profile:host \
  ../EBxelor-2020.12/config/valeria/r-car-h3/profiles/host/keil_arm \
  -r eb_core-releases eb_rt-refapp/0.3.5@EBxelor/2020.12</pre>
</div>
</div>
<div class="paragraph">
<p>For NXP S32G:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ mkdir RT_RefApp
$ cd RT_RefApp
$ conan install --profile:build \
  ../EBxelor-2020.12/config/valeria/s32g/profiles/build/windows_x86_64 \
  --profile:build \
  ../EBxelor-2020.12/config/valeria/s32g/profiles/build/soc_specific \
  --profile:host \
  ../EBxelor-2020.12/config/valeria/s32g/profiles/host/M7 \
  --profile:host \
  ../EBxelor-2020.12/config/valeria/s32g/profiles/host/gcc7_arm32 \
  -r eb_core-releases eb_rt-refapp/0.3.5@EBxelor/2020.12</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This step will just download the RT_RefApp <strong>elf</strong> file.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_build_the_rt_refapp_binaries">Build the RT_RefApp binaries</h5>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Please refer to <a href="#Valeria">Valeria - 构建完整EB xelor软件包</a> for building the RT_RefApp locally.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This chapter will show you how to build the RT_RefApp manually or with CI.</p>
</div>
<div class="paragraph">
<p>RT_RefApp build workflow:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="E83B1387-9D8C-4660-9DCA-23AD07D76041.png" alt="Architecture"></span></p>
</div>
<div class="paragraph">
<p>Please follow the below command instruction to build the RT_RefApp in the local cache.
Replace <code>user/valeria-test</code> by the conan user and channel that you are using.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ mkdir RT_RefApp
$ cd RT_RefApp
$ conan install --build missing \
  --profile:host ../EBcore-main/config/valeria/r-car-h3/profiles/host/R7 \
  --profile:host ../EBcore-main/config/valeria/r-car-h3/profiles/host/keil_arm \
  --profile:build \
  ../EBcore-main/config/valeria/r-car-h3/profiles/build/windows_x86_64 \
  --profile:build \
  ../EBcore-main/config/valeria/r-car-h3/profiles/build/soc_specific \
  ../EBcore-main/pkg/eb_rt-refapp/conan user/valeria-test
$ conan source ../EBcore-main/pkg/eb_rt-refapp/conan/conanfile.py</pre>
</div>
</div>
<div class="paragraph">
<p>The response should be similar to:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Using lockfile: 'D:\tmp\refapp/conan.lock'
Using cached profile from lockfile
conanfile.py (eb_rt-refapp/0.2.0@user/valeria-test): \
Configuring sources in D:\tmp\refapp
conanfile.py (eb_rt-refapp/0.2.0@user/valeria-test): \
Executing exports to: D:\tmp\refapp
conanfile.py (eb_rt-refapp/0.2.0@user/valeria-test): \
exports_sources: Copied 1 file: .project
conanfile.py (eb_rt-refapp/0.2.0@user/valeria-test): \
exports_sources: Copied 32 '.mem' files
conanfile.py (eb_rt-refapp/0.2.0@user/valeria-test): \
exports_sources: Copied 45 '.xdm' files
...</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
If you are using <code>git bash</code> or <code>cygwin</code> console, you can use below command to continue. If you are using Windows <code>cmd</code>, please replace <code>export</code> by <code>set</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Set the environment variable for EB tresos license server:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ export EB_LICENSE_FILE="&lt;Address of the EB tresos license server"</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Here we need to set the absolute path to the RT_RefApp project&#8217;s directory.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Set the environment variable for ARM Keil:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ export ARMLMD_LICENSE_FILE="The adresse of the ARM Keil license server"</pre>
</div>
</div>
<div class="paragraph">
<p>Call the Conan <code>build</code> method to generate the RT_RefApp&#8217;s configuration and make the build</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ conan build ../EBcore-main/pkg/eb_rt-refapp/conan/conanfile.py</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Diagnostic">3.6. Diagnostic</h3>
<div class="paragraph">
<p>EB xelor HPC reference integrates the diagnostic over IP on RT_RefApp with services configuration.</p>
</div>
<div class="sect3">
<h4 id="_overview">3.6.1. Overview</h4>
<div class="paragraph">
<p>DoIp according to ISO13400-2:2011 is implemented.
One tester with address 0x00EF8 for IPv4 and 0x00EF9 for IPv6 is supported.
Physical addressing is supported on target address 0x1148 and functional addressing on 0xEEF8.</p>
</div>
</div>
<div class="sect3">
<h4 id="_diagnostic_services">3.6.2. Diagnostic services</h4>
<div class="paragraph">
<p>The following services are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DiagnosticSessionControl (0x10)</p>
</li>
<li>
<p>EcuReset (0x11)</p>
</li>
<li>
<p>SecurityAccess (0x27)</p>
</li>
<li>
<p>CommunicationControl (0x28)</p>
</li>
<li>
<p>TesterPresent (0x3E)</p>
</li>
<li>
<p>ControlDTCSetting (0x85)</p>
</li>
<li>
<p>ResponseOnEvent (0x86)</p>
</li>
<li>
<p>ReadDataByIdentifier (0x22)</p>
</li>
<li>
<p>WriteDataByIdentifier (0x2E)</p>
</li>
<li>
<p>ClearDiagnosticInformation (0x14)</p>
</li>
<li>
<p>ReadDTCInformation (0x19)</p>
</li>
<li>
<p>RoutineControl (0x31)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="82E43D9D-4A27-4b12-9A39-8A042C0EA74F.png" alt="Architecture"></span></p>
</div>
<div class="sect4">
<h5 id="_diagnosticsessioncontrol_0x10">DiagnosticSessionControl (0x10)</h5>
<div class="paragraph">
<p>RT_RefApp supports DiagnosticSessionControl (0x10). Subservice configuration :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">Security</th>
<th class="tableblock halign-left valign-top">Session</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default, Programming, Extended</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Programming</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default, Programming, Extended</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default, Programming, Extended</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_ecureset_0x11">EcuReset (0x11)</h5>
<div class="paragraph">
<p>RT_RefApp supports EcuReset (0x11). Subservice configuration :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">Security</th>
<th class="tableblock halign-left valign-top">Session</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hardReset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default, Programming, Extended</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_securityaccess_0x27">SecurityAccess (0x27)</h5>
<div class="paragraph">
<p>RT_RefApp supports SecurityAccess (0x27). Subservice configuration :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">Security</th>
<th class="tableblock halign-left valign-top">Session</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">level1_Seed_requestSeed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended, Programming</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Level1_Seed_sendKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended, Programming</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Level3_Seed_requestSeed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Level3_Seed_sendKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_communicationcontrol_0x28">CommunicationControl (0x28)</h5>
<div class="paragraph">
<p>RT_RefApp supports CommunicationControl (0x28). Subservice configuration :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">Security</th>
<th class="tableblock halign-left valign-top">Session</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableRxAndTx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended, Programming</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableRxAndDisableTx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended, Programming</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disableRxAndEnableTx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended, Programming</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disableRxAndTx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended, Programming</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_testerpresent_0x3e">TesterPresent (0x3E)</h5>
<div class="paragraph">
<p>RT_RefApp supports TesterPresent (0x3E). Subservice configuration :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">Security</th>
<th class="tableblock halign-left valign-top">Session</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zeroSubFunction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default, Extended</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_controldtcsetting_0x85">ControlDTCSetting (0x85)</h5>
<div class="paragraph">
<p>RT_RefApp supports ControlDTCSetting (0x85). Subservice configuration :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">Security</th>
<th class="tableblock halign-left valign-top">Session</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">on</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended, Programming</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended, Programming</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_responseonevent_0x86">ResponseOnEvent (0x86)</h5>
<div class="paragraph">
<p>RT_RefApp supports ResponseOnEvent (0x86). Subservice configuration :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">Security</th>
<th class="tableblock halign-left valign-top">Session</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stopResponseOnEvent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default, Extended</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">startResponseOnEvent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x05</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default, Extended</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_readdatabyidentifier_0x22">ReadDataByIdentifier (0x22)</h5>
<div class="paragraph">
<p>RT_RefApp supports ReadDataByIdentifie (0x22). Supported Data Identifier for read :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">Security</th>
<th class="tableblock halign-left valign-top">Session</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DcmDspDid_ActiveDiagnosticInformation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xF186</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default, Programming, Extended</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DcmDspDid_NVM_TEST_BLOCK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xF190</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default, Programming, Extended</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DcmDspDid_VersionInformation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xF19A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default, Programming, Extended</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_writedatabyidentifier_0x2e">WriteDataByIdentifier (0x2E)</h5>
<div class="paragraph">
<p>RT_RefApp supports WriteDataByIdentifier (0x2E). Supported Data Identifier for read :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">Security</th>
<th class="tableblock halign-left valign-top">Session</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DcmDspDid_NVM_TEST_BLOCK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xF190</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default, Programming, Extended</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cleardiagnosticinformation_0x14">ClearDiagnosticInformation (0x14)</h5>
<div class="paragraph">
<p>RT_RefApp supports ClearDiagnosticInformation (0x14). Subservice configuration :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">Security</th>
<th class="tableblock halign-left valign-top">Session</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default, Extended</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_readdtcinformation_0x19">ReadDTCInformation (0x19)</h5>
<div class="paragraph">
<p>RT_RefApp supports ReadDTCInformation (0x19). Subservice configuration :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">Security</th>
<th class="tableblock halign-left valign-top">Session</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reportNumberOfDTCByStatusMask</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default, Extended</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reportDTCByStatusMask</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default, Extended</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reportDTCSnapshotRecordByDTCNumber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default, Extended</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reportDTCExtDataRecordByDTCNumber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x06</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default, Extended</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reportSupportedDTC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default, Extended</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reportDTCFaultDetectionCounter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default, Extended</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reportUserDefMemoryDTCByStatusMask</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default, Extended, Programming</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reportUserDefMemoryDTCSnapshotRecordByDTCNumber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default, Extended, Programming</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reportUserDefMemoryDTCExtDataRecordByDTCNumber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default, Extended, Programming</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_routinecontrol_0x31">RoutineControl (0x31)</h5>
<div class="paragraph">
<p>RT_RefApp supports RoutineControl (0x31). Service configuration :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">Security</th>
<th class="tableblock halign-left valign-top">Session</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DIAGNOSTIC_LOOPBACK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DIAGNOSTIC_TRIGGER_DTC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Network">4. 网络配置指南</h2>
<div class="sectionbody">
<div class="paragraph">
<p>EB xelor provides EB corbos Virtual Ethernet Switch to enable internal and external Ethernet communication of RT_RefApp and all VMs running on Hypervisor.</p>
</div>
<div class="sect2">
<h3 id="_eb_xelor_网络设置">4.1. EB xelor 网络设置</h3>
<div class="paragraph">
<p>EB xelor contains RT_RefApp and VMs running on Hypervisor as the Ethernet user. This chapter lists all Ethernet user Network settings.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>RT_RefApp 网络设置</strong>:</p>
<div class="ulist">
<ul>
<li>
<p><strong>IP 地址</strong>:</p>
<div class="ulist">
<ul>
<li>
<p><strong>IPv4</strong>: 192.168.7.73</p>
</li>
<li>
<p><strong>IPv6</strong>: fd00::eb:73/64</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>MAC 地址</strong>: AA:BB:CC:DD:00:33</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>测试机 IP 地址</strong>:</p>
<div class="ulist">
<ul>
<li>
<p><strong>IPv4</strong>: 192.168.7.100</p>
</li>
<li>
<p><strong>IPv6</strong>: fd00::eb:100/64</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The test machine&#8217;s Ethernet interface settings must be consistent with which of RT_RefApp:
Ethernet interface: 1000Mb/s as speed with FUll duplex.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Currently we have 3 Adaptive AUTOSAR VMs running on Hypervisor:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>vm-hub 网络设置</strong>:</p>
<div class="ulist">
<ul>
<li>
<p><strong>IPv4</strong>: 192.168.7.1</p>
</li>
<li>
<p><strong>IPv6</strong>: fd00::eb:1/64</p>
</li>
<li>
<p><strong>MAC 地址</strong>: AA:BB:CC:DD:00:34</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>vm-alpha 网络设置</strong>:</p>
<div class="ulist">
<ul>
<li>
<p><strong>IPv4</strong>: 192.168.7.2</p>
</li>
<li>
<p><strong>IPv6</strong>: fd00::eb:2/64</p>
</li>
<li>
<p><strong>MAC 地址</strong>: AA:BB:CC:DD:00:35</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>vm-beta 网络设置</strong>:</p>
<div class="ulist">
<ul>
<li>
<p><strong>IPv4</strong>: 192.168.7.3</p>
</li>
<li>
<p><strong>IPv6</strong>: fd00::eb:3/64</p>
</li>
<li>
<p><strong>MAC 地址</strong>: AA:BB:CC:DD:00:36</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="EB_corbos_vSwitch_overview">4.2. EB corbos vSwitch 介绍</h3>
<div class="paragraph">
<p>EB corbos Virtual Ethernet Switch 是 EB corbos 产品线的一部分，也可以使用在 EB tresos 项目中。
本节介绍 EB corbos vSwitch 如何为RT_RefApp和不同的VMs之间提供网络通信。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
EB corbos vSwitch 工作模式和RT_RefApp的调度和内存配置有关。
RT_RefApp操作系统负责配置并保护虚拟机的Virtual Ethernet driver 和 Virtio device proxy的内存分区。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>EB corbos Virtual Ethernet Switch包含以下组件:</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>TODO: Wait to insert a structure photo of vSwitch from EA document</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Virtual Ethernet driver</strong>. 每个虚拟机和RT_RefApp都需要有各自的Virtual Ethernet driver以保证以太网通信。
Virtual Ethernet driver是虚拟机和RT_RefApp 以太网协议栈的底层驱动。
它不会和以太网控制器硬件通信，而是和EB corbos vSwitch通信，包含以下实体:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Reception buffer queue</strong>: The reception buffer queue is used for receiving Ethernet packets and must be configured as non-cached(Which is configured in MkMemoryProtection of OS). Each Virtual Ethernet driver can have one or more reception buffer queues
(separated to receive external and internal traffic).</p>
</li>
<li>
<p><strong>Transmission buffer queue</strong>: The transmission buffer queue is used for transmitting of Ethernet packets and must be configured as non-cached(Which is configured in MkMemoryProtection of OS). There can be one or more transmission buffer queues with own QoS configurations.</p>
</li>
<li>
<p><strong>Control queue</strong>: The control queue is used to communicate to the local MAC addresses (unicast address and multicast addresses) from the Virtual Ethernet driver to the EB corbos vSwitch.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>VirtIO device proxy</strong>. VirtIO device proxy是Hypervisor的一个独立应用。每一个Adaptive AUTOSAR虚拟机都需要有一个VirtIO device proxy
(RT_RefApp和Classic AUTOSAR虚拟机不需要)。 VirtIO device proxy会将所有VirtIO设备配置空间访问转换成与EB corbos vSwitch的shared memory通信。</p>
</li>
<li>
<p><strong>EB corbos Virtual Ethernet Switch</strong>. EB corbos vSwitch 在RT_RefApp中实现，直接控制硬件设备SysDMA和EthCtrl。
它包含以下实例:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Reception buffers (external)</strong>: A buffer queue for receiving multicast and broadcast Ethernet packets from the external Ethernet bus.</p>
</li>
<li>
<p><strong>Reception Dispatcher</strong>: Handle all received Ethernet packets (Both from external Ethernet bus or from internal VMs or RT_RefApp).</p>
</li>
<li>
<p><strong>Transmission Dispatcher</strong>: Detect and forward new Ethernet packets which are ready to transmit in the transmission buffer queues of every Virtual Ethernet driver.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>System DMA</strong> is used for copying ethernet packets from EB corbos vSwitch to different VMs.</p>
</li>
<li>
<p><strong>Ethernet controller</strong> is the hardware unit for sending and receiving of ethernet packets to and from the external Ethernet bus.</p>
</li>
<li>
<p><strong>Hypervisor</strong>: The Hypervisor allocates memory ressources from the global DRAM and maps the appropriate memory regions for the Virtual Ethernet driver and VirtIO device proxy instance to the
different execution environments in order to provide memory separation (for the purpose that different virtual machines may host potentially different guest operating systems).
The Hypervisor handles interrupts and exceptions of the virtual machines (e.g. when a new ethernet packet is available in the reception buffer queue of a virtual machine,
the Hypervisor triggers the according interrupt for the Virtual Ethernet driver in that virtual machine).</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_词汇表">5. 词汇表</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">flash_writer</dt>
<dd>
<p>flash_writer 是有芯片供应商提供的工具，可以用串口通信将它拷贝到目标板上，flash_writer可以用来将数据写到eMMC和QSPI中。</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</body>
</html>